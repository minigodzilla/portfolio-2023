{"version":3,"file":"gallery.js","sources":["../../src/plugins/gallery/constants.js","../../src/plugins/gallery/GalleryButton.js","../../src/plugins/gallery/GalleryComponent.js","../../src/plugins/gallery/index.js"],"sourcesContent":["import { utils } from '../..';\n\n/**\n * @summary Available events\n * @enum {string}\n * @memberof PSV.plugins.GalleryPlugin\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event show-gallery\n   * @memberof PSV.plugins.GalleryPlugin\n   * @summary Triggered when the gallery is shown\n   */\n  SHOW_GALLERY: 'show-gallery',\n  /**\n   * @event hide-gallery\n   * @memberof PSV.plugins.GalleryPlugin\n   * @summary Triggered when the gallery is hidden\n   */\n  HIDE_GALLERY: 'hide-gallery',\n};\n\n/**\n * @summary Property name added to gallery items\n * @type {string}\n * @constant\n * @private\n */\nexport const GALLERY_ITEM_DATA = 'psvGalleryItem';\n\n/**\n * @summary Property name added to gallery items (dash-case)\n * @type {string}\n * @constant\n * @private\n */\nexport const GALLERY_ITEM_DATA_KEY = utils.dasherize(GALLERY_ITEM_DATA);\n\n/**\n * @summary Gallery template\n * @param {PSV.plugins.GalleryPlugin.Item[]} items\n * @param {PSV.Size} size\n * @returns {string}\n * @constant\n * @private\n */\nexport const ITEMS_TEMPLATE = (items, size) => `\n<div class=\"psv-gallery-container\">\n  ${items.map(item => `\n  <div class=\"psv-gallery-item\" data-${GALLERY_ITEM_DATA_KEY}=\"${item.id}\" style=\"width:${size.width}px\">\n    <div class=\"psv-gallery-item-wrapper\" style=\"padding-bottom:calc(100% * ${size.height} / ${size.width})\">\n      ${item.name ? `<div class=\"psv-gallery-item-title\"><span>${item.name}</span></div>` : ''}\n      <svg class=\"psv-gallery-item-thumb\" viewBox=\"0 0 200 200\" preserveAspectRatio=\"xMidYMid slice\"><use href=\"#psvGalleryBlankIcon\"></use></svg>\n      ${item.thumbnail ? `<div class=\"psv-gallery-item-thumb\" data-src=\"${item.thumbnail}\"></div>` : ''}\n    </div>\n  </div>\n  `).join('')}\n</div>\n`;\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport gallery from './gallery.svg';\n\n/**\n * @summary Navigation bar gallery button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class GalleryButton extends AbstractButton {\n\n  static id = 'gallery';\n  static icon = gallery;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-gallery-button', true);\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin}\n     * @readonly\n     * @private\n     */\n    this.plugin = this.psv.getPlugin('gallery');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.SHOW_GALLERY, this);\n      this.plugin.on(EVENTS.HIDE_GALLERY, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.SHOW_GALLERY, this);\n      this.plugin.off(EVENTS.HIDE_GALLERY, this);\n    }\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    if (e.type === EVENTS.SHOW_GALLERY) {\n      this.toggleActive(true);\n    }\n    else if (e.type === EVENTS.HIDE_GALLERY) {\n      this.toggleActive(false);\n    }\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @override\n   * @description Toggles gallery\n   */\n  onClick() {\n    this.plugin.toggle();\n  }\n\n}\n","import { AbstractComponent, SYSTEM, utils } from '../..';\nimport blankIcon from './blank.svg';\nimport { GALLERY_ITEM_DATA, GALLERY_ITEM_DATA_KEY, ITEMS_TEMPLATE } from './constants';\n\nconst ACTIVE_CLASS = 'psv-gallery-item--active';\n\n/**\n * @private\n */\nexport class GalleryComponent extends AbstractComponent {\n\n  constructor(plugin) {\n    super(plugin.psv, 'psv-gallery psv--capture-event');\n\n    /**\n     * @type {SVGElement}\n     * @private\n     * @readonly\n     */\n    this.blankIcon = (() => {\n      const temp = document.createElement('div');\n      temp.innerHTML = blankIcon;\n      return temp.firstChild;\n    })();\n    this.blankIcon.style.display = 'none';\n    this.psv.container.appendChild(this.blankIcon);\n\n    if ('IntersectionObserver' in window) {\n      /**\n       * @type {IntersectionObserver}\n       * @private\n       * @readonly\n       */\n      this.observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n          if (entry.intersectionRatio > 0) {\n            entry.target.style.backgroundImage = `url(${entry.target.dataset.src})`;\n            delete entry.target.dataset.src;\n            this.observer.unobserve(entry.target);\n          }\n        });\n      }, {\n        root: this.psv.container,\n      });\n    }\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = plugin;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.prop = {\n      ...this.prop,\n      mousedown : false,\n      initMouseX: null,\n      mouseX    : null,\n    };\n\n    this.container.addEventListener(SYSTEM.mouseWheelEvent, this);\n    this.container.addEventListener('mousedown', this);\n    this.container.addEventListener('mousemove', this);\n    this.container.addEventListener('click', this);\n    window.addEventListener('mouseup', this);\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.container.removeChild(this.blankIcon);\n\n    window.removeEventListener('mouseup', this);\n\n    this.observer?.disconnect();\n\n    delete this.plugin;\n    delete this.blankIcon;\n    delete this.observer;\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case SYSTEM.mouseWheelEvent:\n        const spinY = utils.normalizeWheel(e).spinY;\n        this.container.scrollLeft += spinY * 50;\n        e.preventDefault();\n        break;\n\n      case 'mousedown':\n        this.prop.mousedown = true;\n        this.prop.initMouseX = e.clientX;\n        this.prop.mouseX = e.clientX;\n        break;\n\n      case 'mousemove':\n        if (this.prop.mousedown) {\n          const delta = this.prop.mouseX - e.clientX;\n          this.container.scrollLeft += delta;\n          this.prop.mouseX = e.clientX;\n        }\n        break;\n\n      case 'mouseup':\n        this.prop.mousedown = false;\n        this.prop.mouseX = null;\n        e.preventDefault();\n        break;\n\n      case 'click':\n        // prevent click on drag\n        if (Math.abs(this.prop.initMouseX - e.clientX) < 10) {\n          const item = utils.getClosest(e.target, `[data-${GALLERY_ITEM_DATA_KEY}]`);\n          if (item) {\n            this.plugin.__click(item.dataset[GALLERY_ITEM_DATA]);\n          }\n        }\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   */\n  show() {\n    this.container.classList.add('psv-gallery--open');\n    this.prop.visible = true;\n  }\n\n  /**\n   * @override\n   */\n  hide() {\n    this.container.classList.remove('psv-gallery--open');\n    this.prop.visible = false;\n  }\n\n  /**\n   * @summary Sets the list of items\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\n   */\n  setItems(items) {\n    this.container.innerHTML = ITEMS_TEMPLATE(items, this.plugin.config.thumbnailSize);\n\n    if (this.observer) {\n      this.observer.disconnect();\n\n      for (const child of this.container.querySelectorAll('[data-src]')) {\n        this.observer.observe(child);\n      }\n    }\n  }\n\n  /**\n   * @param {number | string} id\n   */\n  setActive(id) {\n    const currentActive = this.container.querySelector('.' + ACTIVE_CLASS);\n    currentActive?.classList.remove(ACTIVE_CLASS);\n\n    if (id) {\n      const nextActive = this.container.querySelector(`[data-${GALLERY_ITEM_DATA_KEY}=\"${id}\"]`);\n      nextActive?.classList.add(ACTIVE_CLASS);\n    }\n  }\n\n}\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport { EVENTS } from './constants';\nimport { GalleryButton } from './GalleryButton';\nimport { GalleryComponent } from './GalleryComponent';\nimport './style.scss';\n\n/**\n * @typedef {Object} PSV.plugins.GalleryPlugin.Item\n * @property {number|string} id - Unique identifier of the item\n * @property {*} panorama\n * @property {string} [thumbnail] - URL of the thumbnail\n * @property {string} [name] - Text visible over the thumbnail\n * @property {PSV.PanoramaOptions} [options] - Any option supported by the `setPanorama()` method\n */\n\n/**\n * @typedef {Object} PSV.plugins.GalleryPlugin.Options\n * @property {PSV.plugins.GalleryPlugin.Item[]} [items]\n * @property {boolean} [visibleOnLoad=false] - Displays the gallery when loading the first panorama\n * @property {boolean} [hideOnClick=true] - Hides the gallery when the user clicks on an item\n * @property {PSV.Size} [thumbnailSize] - Size of thumbnails, default (200x100) is set with CSS\n */\n\n\n// add gallery button\nDEFAULTS.lang[GalleryButton.id] = 'Gallery';\nregisterButton(GalleryButton, 'caption:left');\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Adds a gallery of multiple panoramas\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class GalleryPlugin extends AbstractPlugin {\n\n  static id = 'gallery';\n\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.GalleryPlugin.Options} options\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @member {PSV.plugins.GalleryPlugin.Options}\n     * @private\n     */\n    this.config = {\n      items        : null,\n      visibleOnLoad: false,\n      hideOnClick  : true,\n      thumbnailSize: {\n        width : 200,\n        height: 100,\n      },\n      ...options,\n    };\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.prop = {\n      handler  : null,\n      currentId: null,\n    };\n\n    /**\n     * @type {GalleryComponent}\n     * @private\n     * @readonly\n     */\n    this.gallery = new GalleryComponent(this);\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin.Item[]}\n     * @private\n     */\n    this.items = [];\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n\n    if (this.config.visibleOnLoad) {\n      this.psv.once(CONSTANTS.EVENTS.READY, () => {\n        this.show();\n      });\n    }\n\n    this.setItems(this.config.items);\n    delete this.config.items;\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n\n    this.gallery.destroy();\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n        const item = this.items.find(i => utils.deepEqual(i.panorama, e.args[0].panorama));\n        this.prop.currentId = item?.id;\n        this.gallery.setActive(item?.id);\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @summary Shows the gallery\n   * @fires PSV.plugins.GalleryPlugin.show-gallery\n   */\n  show() {\n    this.trigger(EVENTS.SHOW_GALLERY);\n    return this.gallery.show();\n  }\n\n  /**\n   * @summary Hides the carousem\n   * @fires PSV.plugins.GalleryPlugin.hide-gallery\n   */\n  hide() {\n    this.trigger(EVENTS.HIDE_GALLERY);\n    return this.gallery.hide();\n  }\n\n  /**\n   * @summary Hides or shows the gallery\n   */\n  toggle() {\n    return this.gallery.toggle();\n  }\n\n  /**\n   * @summary Sets the list of items\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\n   * @param {function} [handler] function that will be called when an item is clicked instead of the default behavior\n   */\n  setItems(items, handler) {\n    if (!items?.length) {\n      items = [];\n    }\n    else {\n      items.forEach((item, i) => {\n        if (!item.id) {\n          throw new PSVError(`Item ${i} has no \"id\".`);\n        }\n        if (!item.panorama) {\n          throw new PSVError(`Item ${item.id} has no \"panorama\".`);\n        }\n      });\n    }\n\n    this.prop.handler = handler;\n    this.items = items.map(item => ({\n      ...item,\n      id: `${item.id}`,\n    }));\n\n    this.gallery.setItems(items);\n  }\n\n  /**\n   * @param {string} id\n   * @package\n   */\n  __click(id) {\n    if (id === this.prop.currentId) {\n      return;\n    }\n\n    if (this.prop.handler) {\n      this.prop.handler(id);\n    }\n    else {\n      const item = this.items.find(i => i.id === id);\n      this.psv.setPanorama(item.panorama, {\n        caption: item.name,\n        ...item.options,\n      });\n    }\n\n    this.prop.currentId = id;\n    this.gallery.setActive(id);\n\n    if (this.config.hideOnClick) {\n      this.hide();\n    }\n  }\n\n}\n"],"names":["EVENTS","SHOW_GALLERY","HIDE_GALLERY","GALLERY_ITEM_DATA","GALLERY_ITEM_DATA_KEY","utils","dasherize","ITEMS_TEMPLATE","items","size","map","item","id","width","height","name","thumbnail","join","GalleryButton","navbar","plugin","psv","getPlugin","on","destroy","off","handleEvent","e","type","toggleActive","isSupported","onClick","toggle","AbstractButton","icon","gallery","ACTIVE_CLASS","GalleryComponent","blankIcon","temp","document","createElement","innerHTML","firstChild","style","display","container","appendChild","window","observer","IntersectionObserver","entries","forEach","entry","intersectionRatio","target","backgroundImage","dataset","src","unobserve","root","prop","mousedown","initMouseX","mouseX","addEventListener","SYSTEM","mouseWheelEvent","hide","removeChild","removeEventListener","disconnect","spinY","normalizeWheel","scrollLeft","preventDefault","clientX","delta","Math","abs","getClosest","__click","show","classList","add","visible","remove","setItems","config","thumbnailSize","querySelectorAll","child","observe","setActive","currentActive","querySelector","nextActive","AbstractComponent","DEFAULTS","lang","registerButton","GalleryPlugin","options","visibleOnLoad","hideOnClick","handler","currentId","init","CONSTANTS","PANORAMA_LOADED","once","READY","find","i","deepEqual","panorama","args","trigger","length","PSVError","setPanorama","caption","AbstractPlugin"],"mappings":"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"}