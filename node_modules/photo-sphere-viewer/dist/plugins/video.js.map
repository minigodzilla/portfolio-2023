{"version":3,"file":"video.js","sources":["../../src/plugins/video/constants.js","../../src/plugins/video/PauseOverlay.js","../../src/plugins/video/PlayPauseButton.js","../../src/plugins/video/utils.js","../../src/plugins/video/ProgressBar.js","../../src/plugins/video/TimeCaption.js","../../src/plugins/video/VolumeButton.js","../../src/plugins/video/index.js"],"sourcesContent":["export const EVENTS = {\n  /**\n   * @event play\n   * @memberof PSV.plugins.VideoPlugin\n   * @summary Triggered when the video starts playing\n   */\n  PLAY         : 'play',\n  /**\n   * @event pause\n   * @memberof PSV.plugins.VideoPlugin\n   * @summary Triggered when the video is paused\n   */\n  PAUSE        : 'pause',\n  /**\n   * @event volume-change\n   * @memberof PSV.plugins.VideoPlugin\n   * @summary Triggered when the video volume changes\n   * @param {number} volume\n   */\n  VOLUME_CHANGE: 'volume-change',\n  /**\n   * @event progress\n   * @memberof PSV.plugins.VideoPlugin\n   * @summary Triggered when the video play progression changes\n   * @param {{time: number, duration: number, progress: number}} data\n   */\n  PROGRESS     : 'progress',\n  /**\n   * @event buffer\n   * @memberof PSV.plugins.VideoPlugin\n   * @summary Triggered when the video buffer changes\n   * @param {number} maxBuffer\n   */\n  BUFFER       : 'buffer',\n};\n","import { AbstractComponent, CONSTANTS, utils } from '../..';\nimport { EVENTS } from './constants';\nimport playIcon from './play.svg';\n\n/**\n * @private\n */\nexport class PauseOverlay extends AbstractComponent {\n\n  constructor(plugin) {\n    super(plugin.psv, 'psv-video-overlay');\n\n    /**\n     * @type {PSV.plugins.VideoPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = plugin;\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.button = document.createElement('button');\n    this.button.className = 'psv-video-bigbutton psv--capture-event';\n    this.button.innerHTML = playIcon;\n    this.container.appendChild(this.button);\n\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.plugin.on(EVENTS.PLAY, this);\n    this.plugin.on(EVENTS.PAUSE, this);\n    this.button.addEventListener('click', this);\n  }\n\n  /**\n   * @private\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.plugin.off(EVENTS.PLAY, this);\n    this.plugin.off(EVENTS.PAUSE, this);\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n      case EVENTS.PLAY:\n      case EVENTS.PAUSE:\n        utils.toggleClass(this.button, 'psv-video-bigbutton--pause', !this.plugin.isPlaying());\n        break;\n      case 'click':\n        this.plugin.playPause();\n        break;\n    }\n    /* eslint-enable */\n  }\n\n}\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport pauseIcon from './pause.svg';\nimport playIcon from './play.svg';\n\n/**\n * @summary Navigation bar video play/pause button\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class PlayPauseButton extends AbstractButton {\n\n  static id = 'videoPlay';\n  static groupId = 'video';\n  static icon = playIcon;\n  static iconActive = pauseIcon;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-video-play-button', true);\n\n    /**\n     * @type {PSV.plugins.VideoPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = this.psv.getPlugin('video');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.PLAY, this);\n      this.plugin.on(EVENTS.PAUSE, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.PLAY, this);\n      this.plugin.off(EVENTS.PAUSE, this);\n    }\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case EVENTS.PLAY:\n      case EVENTS.PAUSE:\n        this.toggleActive(this.plugin.isPlaying());\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles video playback\n   */\n  onClick() {\n    this.plugin.playPause();\n  }\n\n}\n","/**\n * @private\n */\nexport function formatTime(time) {\n  const seconds = Math.round(time % 60);\n  const minutes = Math.round(time - seconds) / 60;\n  return `${minutes}:${('0' + seconds).slice(-2)}`;\n}\n","import { AbstractComponent, CONSTANTS, utils } from '../..';\nimport { EVENTS } from './constants';\nimport { formatTime } from './utils';\n\n/**\n * @private\n */\nexport class ProgressBar extends AbstractComponent {\n\n  constructor(plugin) {\n    super(plugin.psv, 'psv-video-progressbar');\n\n    /**\n     * @type {PSV.plugins.VideoPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = plugin;\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.bufferElt = document.createElement('div');\n    this.bufferElt.className = 'psv-video-progressbar__buffer';\n    this.container.appendChild(this.bufferElt);\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.progressElt = document.createElement('div');\n    this.progressElt.className = 'psv-video-progressbar__progress';\n    this.container.appendChild(this.progressElt);\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.handleElt = document.createElement('div');\n    this.handleElt.className = 'psv-video-progressbar__handle';\n    this.container.appendChild(this.handleElt);\n\n    /**\n     * @type {PSV.utils.Slider}\n     * @private\n     * @readonly\n     */\n    this.slider = new utils.Slider({\n      psv      : this.psv,\n      container: this.container,\n      direction: utils.Slider.HORIZONTAL,\n      onUpdate : e => this.__onSliderUpdate(e),\n    });\n\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.plugin.on(EVENTS.BUFFER, this);\n    this.plugin.on(EVENTS.PROGRESS, this);\n\n    this.prop.req = window.requestAnimationFrame(() => this.__updateProgress());\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.plugin.off(EVENTS.BUFFER, this);\n    this.plugin.off(EVENTS.PROGRESS, this);\n\n    this.slider.destroy();\n    this.prop.tooltip?.hide();\n    window.cancelAnimationFrame(this.prop.req);\n\n    delete this.prop.tooltip;\n    delete this.slider;\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n      case EVENTS.BUFFER:\n      case EVENTS.PROGRESS:\n        this.bufferElt.style.width = `${this.plugin.getBufferProgress() * 100}%`;\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @private\n   */\n  __updateProgress() {\n    this.progressElt.style.width = `${this.plugin.getProgress() * 100}%`;\n\n    this.prop.req = window.requestAnimationFrame(() => this.__updateProgress());\n  }\n\n  /**\n   * @private\n   */\n  __onSliderUpdate(e) {\n    if (e.mouseover) {\n      this.handleElt.style.display = 'block';\n      this.handleElt.style.left = `${e.value * 100}%`;\n\n      const time = formatTime(this.plugin.getDuration() * e.value);\n\n      if (!this.prop.tooltip) {\n        this.prop.tooltip = this.psv.tooltip.create({\n          top    : e.cursor.clientY,\n          left   : e.cursor.clientX,\n          content: time,\n        });\n      }\n      else {\n        this.prop.tooltip.content.innerHTML = time;\n        this.prop.tooltip.move({\n          top : e.cursor.clientY,\n          left: e.cursor.clientX,\n        });\n      }\n    }\n    else {\n      this.handleElt.style.display = 'none';\n\n      this.prop.tooltip?.hide();\n      delete this.prop.tooltip;\n    }\n    if (e.click) {\n      this.plugin.setProgress(e.value);\n    }\n  }\n\n}\n","import { AbstractComponent, CONSTANTS } from '../..';\nimport { EVENTS } from './constants';\nimport { formatTime } from './utils';\n\n/**\n * @summary Navigation bar video time display\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class TimeCaption extends AbstractComponent {\n\n  static id = 'videoTime';\n  static groupId = 'video';\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-caption psv-video-time');\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.content = document.createElement('div');\n    this.content.className = 'psv-caption-content';\n    this.container.appendChild(this.content);\n\n    /**\n     * @type {PSV.plugins.VideoPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = this.psv.getPlugin('video');\n\n    if (this.plugin) {\n      this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n      this.plugin.on(EVENTS.PROGRESS, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n      this.plugin.off(EVENTS.PROGRESS, this);\n    }\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n      case EVENTS.PROGRESS:\n        this.content.innerHTML = `<strong>${formatTime(this.plugin.getTime())}</strong> / ${formatTime(this.plugin.getDuration())}`;\n        break;\n    }\n    /* eslint-enable */\n  }\n\n}\n","import { AbstractButton, CONSTANTS, utils } from '../..';\nimport { EVENTS } from './constants';\nimport volumeIcon from './volume.svg';\n\n/**\n * @summary Navigation bar video volume button\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class VolumeButton extends AbstractButton {\n\n  static id = 'videoVolume';\n  static groupId = 'video';\n  static icon = volumeIcon;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-video-volume-button', true);\n\n    /**\n     * @type {PSV.plugins.VideoPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = this.psv.getPlugin('video');\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.rangeContainer = document.createElement('div');\n    this.rangeContainer.className = 'psv-video-volume__container';\n    this.container.appendChild(this.rangeContainer);\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.range = document.createElement('div');\n    this.range.className = 'psv-video-volume__range';\n    this.rangeContainer.appendChild(this.range);\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.trackElt = document.createElement('div');\n    this.trackElt.className = 'psv-video-volume__track';\n    this.range.appendChild(this.trackElt);\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.progressElt = document.createElement('div');\n    this.progressElt.className = 'psv-video-volume__progress';\n    this.range.appendChild(this.progressElt);\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     * @readonly\n     */\n    this.handleElt = document.createElement('div');\n    this.handleElt.className = 'psv-video-volume__handle';\n    this.range.appendChild(this.handleElt);\n\n    /**\n     * @type {PSV.utils.Slider}\n     * @private\n     * @readonly\n     */\n    this.slider = new utils.Slider({\n      psv      : this.psv,\n      container: this.range,\n      direction: utils.Slider.VERTICAL,\n      onUpdate : e => this.__onSliderUpdate(e),\n    });\n\n    if (this.plugin) {\n      this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n      this.plugin.on(EVENTS.PLAY, this);\n      this.plugin.on(EVENTS.VOLUME_CHANGE, this);\n\n      this.__setVolume(0);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n      this.plugin.off(EVENTS.PLAY, this);\n      this.plugin.off(EVENTS.VOLUME_CHANGE, this);\n    }\n\n    this.slider.destroy();\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n      case EVENTS.PLAY:\n      case EVENTS.VOLUME_CHANGE:\n        this.__setVolume(this.plugin.getVolume());\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles video muted\n   */\n  onClick() {\n    this.plugin.setMute();\n  }\n\n  /**\n   * @private\n   */\n  __onSliderUpdate(e) {\n    if (e.mousedown) {\n      this.plugin.setVolume(e.value);\n    }\n  }\n\n  /**\n   * @private\n   */\n  __setVolume(volume) {\n    let level;\n    if (volume === 0) level = 0;\n    else if (volume < 0.333) level = 1;\n    else if (volume < 0.666) level = 2;\n    else level = 3;\n\n    utils.toggleClass(this.container, 'psv-video-volume-button--0', level === 0);\n    utils.toggleClass(this.container, 'psv-video-volume-button--1', level === 1);\n    utils.toggleClass(this.container, 'psv-video-volume-button--2', level === 2);\n    utils.toggleClass(this.container, 'psv-video-volume-button--3', level === 3);\n\n    this.handleElt.style.bottom = `${volume * 100}%`;\n    this.progressElt.style.height = `${volume * 100}%`;\n  }\n\n}\n","import { SplineCurve, Vector2 } from 'three';\nimport { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport { EVENTS } from './constants';\nimport { PauseOverlay } from './PauseOverlay';\nimport { PlayPauseButton } from './PlayPauseButton';\nimport { ProgressBar } from './ProgressBar';\nimport { TimeCaption } from './TimeCaption';\nimport { VolumeButton } from './VolumeButton';\nimport './style.scss';\n\n\n/**\n * @typedef {Object} PSV.plugins.VideoPlugin.Keypoint\n * @property {PSV.ExtendedPosition} position\n * @property {number} time\n */\n\n/**\n * @typedef {Object} PSV.plugins.VideoPlugin.Options\n * @property {boolean} [progressbar=true] - displays a progressbar on top of the navbar\n * @property {boolean} [bigbutton=true] - displays a big \"play\" button in the center of the viewer\n * @property {PSV.plugins.VideoPlugin.Keypoint[]} [keypoints] - defines autorotate timed keypoints\n */\n\n\n// add video buttons\nDEFAULTS.lang[PlayPauseButton.id] = 'Play/Pause';\nDEFAULTS.lang[VolumeButton.id] = 'Volume';\nregisterButton(PlayPauseButton);\nregisterButton(VolumeButton);\nregisterButton(TimeCaption);\nDEFAULTS.navbar.unshift(PlayPauseButton.groupId);\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Controls a video adapter\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class VideoPlugin extends AbstractPlugin {\n\n  static id = 'video';\n\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.VideoPlugin.Options} options\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    if (!this.psv.adapter.constructor.id.includes('video')) {\n      throw new PSVError('VideoPlugin can only be used with a video adapter.');\n    }\n\n    /**\n     * @member {Object}\n     * @property {THREE.SplineCurve} curve\n     * @property {PSV.plugins.VideoPlugin.Keypoint} start\n     * @property {PSV.plugins.VideoPlugin.Keypoint} end\n     * @property {PSV.plugins.VideoPlugin.Keypoint[]} keypoints\n     * @private\n     */\n    this.autorotate = {\n      curve    : null,\n      start    : null,\n      end      : null,\n      keypoints: null,\n    };\n\n    /**\n     * @member {PSV.plugins.VideoPlugin.Options}\n     * @private\n     */\n    this.config = {\n      progressbar: true,\n      bigbutton  : true,\n      ...options,\n    };\n\n    if (this.config.progressbar) {\n      this.progressbar = new ProgressBar(this);\n    }\n\n    if (this.config.bigbutton) {\n      this.overlay = new PauseOverlay(this);\n    }\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     * @private\n     */\n    this.markers = null;\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.markers = this.psv.getPlugin('markers');\n\n    if (this.config.keypoints) {\n      this.setKeypoints(this.config.keypoints);\n      delete this.config.keypoints;\n    }\n\n    this.psv.on(CONSTANTS.EVENTS.AUTOROTATE, this);\n    this.psv.on(CONSTANTS.EVENTS.BEFORE_RENDER, this);\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.psv.on(CONSTANTS.EVENTS.KEY_PRESS, this);\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.AUTOROTATE, this);\n    this.psv.off(CONSTANTS.EVENTS.BEFORE_RENDER, this);\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.psv.off(CONSTANTS.EVENTS.KEY_PRESS, this);\n\n    delete this.autorotate;\n    delete this.progressbar;\n    delete this.overlay;\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    // @formatter:off\n    switch (e.type) {\n      case CONSTANTS.EVENTS.BEFORE_RENDER:\n        this.__autorotate();\n        break;\n      case CONSTANTS.EVENTS.AUTOROTATE:\n        this.__configureAutorotate();\n        break;\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n        this.__bindVideo(e.args[0]);\n        this.progressbar?.show();\n        break;\n      case CONSTANTS.EVENTS.KEY_PRESS:\n        this.__onKeyPress(e, e.args[0]);\n        break;\n      case 'play':         this.trigger(EVENTS.PLAY); break;\n      case 'pause':        this.trigger(EVENTS.PAUSE); break;\n      case 'progress':     this.trigger(EVENTS.BUFFER, this.getBufferProgress()); break;\n      case 'volumechange': this.trigger(EVENTS.VOLUME_CHANGE, this.getVolume()); break;\n      case 'timeupdate':\n        this.trigger(EVENTS.PROGRESS, {\n          time    : this.getTime(),\n          duration: this.getDuration(),\n          progress: this.getProgress(),\n        });\n        break;\n    }\n    // @formatter:on\n    /* eslint-enable */\n  }\n\n  /**\n   * @private\n   */\n  __bindVideo(textureData) {\n    this.video = textureData.texture.image;\n\n    this.video.addEventListener('play', this);\n    this.video.addEventListener('pause', this);\n    this.video.addEventListener('progress', this);\n    this.video.addEventListener('volumechange', this);\n    this.video.addEventListener('timeupdate', this);\n  }\n\n  /**\n   * @private\n   */\n  __onKeyPress(e, key) {\n    if (key === CONSTANTS.KEY_CODES.Space) {\n      this.playPause();\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * @summary Returns the durection of the video\n   * @returns {number}\n   */\n  getDuration() {\n    return this.video?.duration ?? 0;\n  }\n\n  /**\n   * @summary Returns the current time of the video\n   * @returns {number}\n   */\n  getTime() {\n    return this.video?.currentTime ?? 0;\n  }\n\n  /**\n   * @summary Returns the play progression of the video\n   * @returns {number} 0-1\n   */\n  getProgress() {\n    return this.video ? this.video.currentTime / this.video.duration : 0;\n  }\n\n  /**\n   * @summary Returns if the video is playing\n   * @returns {boolean}\n   */\n  isPlaying() {\n    return this.video ? !this.video.paused : false;\n  }\n\n  /**\n   * @summary Returns the video volume\n   * @returns {number}\n   */\n  getVolume() {\n    return this.video?.muted ? 0 : this.video?.volume ?? 0;\n  }\n\n  /**\n   * @summary Starts or pause the video\n   */\n  playPause() {\n    if (this.video) {\n      if (this.video.paused) {\n        this.video.play();\n      }\n      else {\n        this.video.pause();\n      }\n    }\n  }\n\n  /**\n   * @summary Starts the video if paused\n   */\n  play() {\n    if (this.video && this.video.paused) {\n      this.video.play();\n    }\n  }\n\n  /**\n   * @summary Pauses the cideo if playing\n   */\n  pause() {\n    if (this.video && !this.video.paused) {\n      this.video.pause();\n    }\n  }\n\n  /**\n   * @summary Sets the volume of the video\n   * @param {number} volume\n   */\n  setVolume(volume) {\n    if (this.video) {\n      this.video.muted = false;\n      this.video.volume = volume;\n    }\n  }\n\n  /**\n   * @summary (Un)mutes the video\n   * @param {boolean} [mute] - toggle if undefined\n   */\n  setMute(mute) {\n    if (this.video) {\n      this.video.muted = mute === undefined ? !this.video.muted : mute;\n      if (!this.video.muted && this.video.volume === 0) {\n        this.video.volume = 0.1;\n      }\n    }\n  }\n\n  /**\n   * @summary Changes the current time of the video\n   * @param {number} time\n   */\n  setTime(time) {\n    if (this.video) {\n      this.video.currentTime = time;\n    }\n  }\n\n  /**\n   * @summary Changes the progression of the video\n   * @param {number} progress 0-1\n   */\n  setProgress(progress) {\n    if (this.video) {\n      this.video.currentTime = this.video.duration * progress;\n    }\n  }\n\n  getBufferProgress() {\n    if (this.video) {\n      let maxBuffer = 0;\n\n      const buffer = this.video.buffered;\n\n      for (let i = 0, l = buffer.length; i < l; i++) {\n        if (buffer.start(i) <= this.video.currentTime && buffer.end(i) >= this.video.currentTime) {\n          maxBuffer = buffer.end(i);\n          break;\n        }\n      }\n\n      return Math.max(this.video.currentTime, maxBuffer) / this.video.duration;\n    }\n    else {\n      return 0;\n    }\n  }\n\n  /**\n   * @summary Changes the keypoints\n   * @param {PSV.plugins.VideoPlugin.Keypoint[]} keypoints\n   */\n  setKeypoints(keypoints) {\n    if (keypoints && keypoints.length < 2) {\n      throw new PSVError('At least two points are required');\n    }\n\n    this.autorotate.keypoints = utils.clone(keypoints);\n\n    if (this.autorotate.keypoints) {\n      this.autorotate.keypoints.forEach((pt, i) => {\n        if (pt.position) {\n          const position = this.psv.dataHelper.cleanPosition(pt.position);\n          pt.position = [position.longitude, position.latitude];\n        }\n        else {\n          throw new PSVError(`Keypoint #${i} is missing marker or position`);\n        }\n\n        if (utils.isNil(pt.time)) {\n          throw new PSVError(`Keypoint #${i} is missing time`);\n        }\n      });\n\n      this.autorotate.keypoints.sort((a, b) => a.time - b.time);\n    }\n\n    this.__configureAutorotate();\n  }\n\n  /**\n   * @private\n   */\n  __configureAutorotate() {\n    delete this.autorotate.curve;\n    delete this.autorotate.start;\n    delete this.autorotate.end;\n\n    if (this.psv.isAutorotateEnabled() && this.autorotate.keypoints) {\n      // cancel core rotation\n      this.psv.dynamics.position.stop();\n    }\n  }\n\n  /**\n   * @private\n   */\n  __autorotate() {\n    if (!this.psv.isAutorotateEnabled() || !this.autorotate.keypoints) {\n      return;\n    }\n\n    const currentTime = this.getTime();\n    const autorotate = this.autorotate;\n\n    if (!autorotate.curve || currentTime < autorotate.start.time || currentTime >= autorotate.end.time) {\n      this.__autorotateNext(currentTime);\n    }\n\n    if (autorotate.start === autorotate.end) {\n      this.psv.rotate({\n        longitude: autorotate.start.position[0],\n        latitude : autorotate.start.position[1],\n      });\n    }\n    else {\n      const progress = (currentTime - autorotate.start.time) / (autorotate.end.time - autorotate.start.time);\n      // only the middle segment contains the current section\n      const pt = autorotate.curve.getPoint(1 / 3 + progress / 3);\n\n      this.psv.dynamics.position.goto({\n        longitude: pt.x,\n        latitude : pt.y,\n      });\n    }\n  }\n\n  /**\n   * @private\n   */\n  __autorotateNext(currentTime) {\n    let k1 = null;\n    let k2 = null;\n\n    const keypoints = this.autorotate.keypoints;\n    const l = keypoints.length - 1;\n\n    if (currentTime < keypoints[0].time) {\n      k1 = 0;\n      k2 = 0;\n    }\n    for (let i = 0; i < l; i++) {\n      if (currentTime >= keypoints[i].time && currentTime < keypoints[i + 1].time) {\n        k1 = i;\n        k2 = i + 1;\n        break;\n      }\n    }\n    if (currentTime >= keypoints[l].time) {\n      k1 = l;\n      k2 = l;\n    }\n\n    // get the 4 points necessary to compute the current movement\n    // one point before and two points after the current\n    const workPoints = [\n      keypoints[Math.max(0, k1 - 1)].position,\n      keypoints[k1].position,\n      keypoints[k2].position,\n      keypoints[Math.min(l, k2 + 1)].position,\n    ];\n\n    // apply offsets to avoid crossing the origin\n    const workVectors = [new Vector2(workPoints[0][0], workPoints[0][1])];\n\n    let k = 0;\n    for (let i = 1; i <= 3; i++) {\n      const d = workPoints[i - 1][0] - workPoints[i][0];\n      if (d > Math.PI) { // crossed the origin left to right\n        k += 1;\n      }\n      else if (d < -Math.PI) { // crossed the origin right to left\n        k -= 1;\n      }\n      if (k !== 0 && i === 1) {\n        // do not modify first point, apply the reverse offset the the previous point instead\n        workVectors[0].x -= k * 2 * Math.PI;\n        k = 0;\n      }\n      workVectors.push(new Vector2(workPoints[i][0] + k * 2 * Math.PI, workPoints[i][1]));\n    }\n\n    this.autorotate.curve = new SplineCurve(workVectors);\n    this.autorotate.start = keypoints[k1];\n    this.autorotate.end = keypoints[k2];\n\n    // debugCurve(this.markers, this.autorotate.curve.getPoints(16 * 3).map(p => ([p.x, p.y])), 16);\n  }\n\n}\n"],"names":["EVENTS","PLAY","PAUSE","VOLUME_CHANGE","PROGRESS","BUFFER","PauseOverlay","plugin","psv","button","document","createElement","className","innerHTML","playIcon","container","appendChild","on","CONSTANTS","PANORAMA_LOADED","addEventListener","destroy","off","handleEvent","e","type","utils","toggleClass","isPlaying","playPause","AbstractComponent","PlayPauseButton","navbar","getPlugin","isSupported","toggleActive","onClick","AbstractButton","id","groupId","icon","iconActive","pauseIcon","formatTime","time","seconds","Math","round","minutes","slice","ProgressBar","bufferElt","progressElt","handleElt","slider","Slider","direction","HORIZONTAL","onUpdate","__onSliderUpdate","prop","req","window","requestAnimationFrame","__updateProgress","hide","tooltip","cancelAnimationFrame","style","width","getBufferProgress","getProgress","mouseover","display","left","value","getDuration","create","top","cursor","clientY","clientX","content","move","click","setProgress","TimeCaption","getTime","VolumeButton","rangeContainer","range","trackElt","VERTICAL","__setVolume","getVolume","setMute","mousedown","setVolume","volume","level","bottom","height","volumeIcon","DEFAULTS","lang","registerButton","unshift","VideoPlugin","options","adapter","constructor","includes","PSVError","autorotate","curve","start","end","keypoints","config","progressbar","bigbutton","overlay","markers","init","setKeypoints","AUTOROTATE","BEFORE_RENDER","KEY_PRESS","__autorotate","__configureAutorotate","__bindVideo","args","show","__onKeyPress","trigger","duration","progress","textureData","video","texture","image","key","KEY_CODES","Space","preventDefault","currentTime","paused","muted","play","pause","mute","undefined","setTime","maxBuffer","buffer","buffered","i","l","length","max","clone","forEach","pt","position","dataHelper","cleanPosition","longitude","latitude","isNil","sort","a","b","isAutorotateEnabled","dynamics","stop","__autorotateNext","rotate","getPoint","goto","x","y","k1","k2","workPoints","min","workVectors","Vector2","k","d","PI","push","SplineCurve","AbstractPlugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAAaA,MAAM,GAAG;EACpB;EACF;EACA;EACA;EACA;EACEC,EAAAA,IAAI,EAAW,MANK;;EAOpB;EACF;EACA;EACA;EACA;EACEC,EAAAA,KAAK,EAAU,OAZK;;EAapB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,aAAa,EAAE,eAnBK;;EAoBpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,QAAQ,EAAO,UA1BK;;EA2BpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,MAAM,EAAS;EAjCK;;;;ECItB;EACA;EACA;;MACaC,YAAb;EAAA;;EAEE,wBAAYC,MAAZ,EAAoB;EAAA;;EAClB,0CAAMA,MAAM,CAACC,GAAb,EAAkB,mBAAlB;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAKD,MAAL,GAAcA,MAAd;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAKE,MAAL,GAAcC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd;EACA,UAAKF,MAAL,CAAYG,SAAZ,GAAwB,wCAAxB;EACA,UAAKH,MAAL,CAAYI,SAAZ,GAAwBC,QAAxB;;EACA,UAAKC,SAAL,CAAeC,WAAf,CAA2B,MAAKP,MAAhC;;EAEA,UAAKD,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiBmB,eAA7B;;EACA,UAAKZ,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACC,IAAtB;;EACA,UAAKM,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACE,KAAtB;;EACA,UAAKO,MAAL,CAAYW,gBAAZ,CAA6B,OAA7B;;EAvBkB;EAwBnB;EAED;EACF;EACA;;;EA9BA;;EAAA,SA+BEC,OA/BF,GA+BE,mBAAU;EACR,SAAKb,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiBmB,eAA9B,EAA+C,IAA/C;EACA,SAAKZ,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACC,IAAvB,EAA6B,IAA7B;EACA,SAAKM,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACE,KAAvB,EAA8B,IAA9B;EAEA,WAAO,KAAKK,MAAZ;;EAEA,iCAAMc,OAAN;EACD;EAED;EACF;EACA;EACA;EACA;EA7CA;;EAAA,SA8CEE,WA9CF,GA8CE,qBAAYC,CAAZ,EAAe;EACb;EACA,YAAQA,CAAC,CAACC,IAAV;EACE,WAAKP,2BAAS,CAAClB,MAAV,CAAiBmB,eAAtB;EACA,WAAKnB,MAAM,CAACC,IAAZ;EACA,WAAKD,MAAM,CAACE,KAAZ;EACEwB,QAAAA,uBAAK,CAACC,WAAN,CAAkB,KAAKlB,MAAvB,EAA+B,4BAA/B,EAA6D,CAAC,KAAKF,MAAL,CAAYqB,SAAZ,EAA9D;EACA;;EACF,WAAK,OAAL;EACE,aAAKrB,MAAL,CAAYsB,SAAZ;EACA;EARJ;EAUA;;EACD,GA3DH;;EAAA;EAAA,EAAkCC,mCAAlC;;;;ECFA;EACA;EACA;EACA;EACA;;MACaC,eAAb;EAAA;;EAOE;EACF;EACA;EACE,2BAAYC,MAAZ,EAAoB;EAAA;;EAClB,uCAAMA,MAAN,EAAc,+CAAd,EAA+D,IAA/D;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAKzB,MAAL,GAAc,MAAKC,GAAL,CAASyB,SAAT,CAAmB,OAAnB,CAAd;;EAEA,QAAI,MAAK1B,MAAT,EAAiB;EACf,YAAKA,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACC,IAAtB;;EACA,YAAKM,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACE,KAAtB;EACD;;EAbiB;EAcnB;EAED;EACF;EACA;;;EA5BA;;EAAA,SA6BEmB,OA7BF,GA6BE,mBAAU;EACR,QAAI,KAAKd,MAAT,EAAiB;EACf,WAAKA,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACC,IAAvB,EAA6B,IAA7B;EACA,WAAKM,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACE,KAAvB,EAA8B,IAA9B;EACD;;EAED,WAAO,KAAKK,MAAZ;;EAEA,8BAAMc,OAAN;EACD;EAED;EACF;EACA;EA1CA;;EAAA,SA2CEa,WA3CF,GA2CE,uBAAc;EACZ,WAAO,CAAC,CAAC,KAAK3B,MAAd;EACD;EAED;EACF;EACA;EACA;EACA;EAnDA;;EAAA,SAoDEgB,WApDF,GAoDE,qBAAYC,CAAZ,EAAe;EACb;EACA,YAAQA,CAAC,CAACC,IAAV;EACE,WAAKzB,MAAM,CAACC,IAAZ;EACA,WAAKD,MAAM,CAACE,KAAZ;EACE,aAAKiC,YAAL,CAAkB,KAAK5B,MAAL,CAAYqB,SAAZ,EAAlB;EACA;EAJJ;EAMA;;EACD;EAED;EACF;EACA;EACA;EAlEA;;EAAA,SAmEEQ,OAnEF,GAmEE,mBAAU;EACR,SAAK7B,MAAL,CAAYsB,SAAZ;EACD,GArEH;;EAAA;EAAA,EAAqCQ,gCAArC;EAAaN,gBAEJO,KAAK;EAFDP,gBAGJQ,UAAU;EAHNR,gBAIJS,OAAO1B;EAJHiB,gBAKJU,aAAaC;;ECftB;EACA;EACA;EACO,SAASC,UAAT,CAAoBC,IAApB,EAA0B;EAC/B,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWH,IAAI,GAAG,EAAlB,CAAhB;EACA,MAAMI,OAAO,GAAGF,IAAI,CAACC,KAAL,CAAWH,IAAI,GAAGC,OAAlB,IAA6B,EAA7C;EACA,SAAUG,OAAV,SAAqB,CAAC,MAAMH,OAAP,EAAgBI,KAAhB,CAAsB,CAAC,CAAvB,CAArB;EACD;;ECHD;EACA;EACA;;MACaC,WAAb;EAAA;;EAEE,uBAAY3C,MAAZ,EAAoB;EAAA;;EAClB,0CAAMA,MAAM,CAACC,GAAb,EAAkB,uBAAlB;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAKD,MAAL,GAAcA,MAAd;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAK4C,SAAL,GAAiBzC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;EACA,UAAKwC,SAAL,CAAevC,SAAf,GAA2B,+BAA3B;;EACA,UAAKG,SAAL,CAAeC,WAAf,CAA2B,MAAKmC,SAAhC;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKC,WAAL,GAAmB1C,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAnB;EACA,UAAKyC,WAAL,CAAiBxC,SAAjB,GAA6B,iCAA7B;;EACA,UAAKG,SAAL,CAAeC,WAAf,CAA2B,MAAKoC,WAAhC;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKC,SAAL,GAAiB3C,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;EACA,UAAK0C,SAAL,CAAezC,SAAf,GAA2B,+BAA3B;;EACA,UAAKG,SAAL,CAAeC,WAAf,CAA2B,MAAKqC,SAAhC;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKC,MAAL,GAAc,IAAI5B,uBAAK,CAAC6B,MAAV,CAAiB;EAC7B/C,MAAAA,GAAG,EAAQ,MAAKA,GADa;EAE7BO,MAAAA,SAAS,EAAE,MAAKA,SAFa;EAG7ByC,MAAAA,SAAS,EAAE9B,uBAAK,CAAC6B,MAAN,CAAaE,UAHK;EAI7BC,MAAAA,QAAQ,EAAG,kBAAAlC,CAAC;EAAA,eAAI,MAAKmC,gBAAL,CAAsBnC,CAAtB,CAAJ;EAAA;EAJiB,KAAjB,CAAd;;EAOA,UAAKhB,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiBmB,eAA7B;;EACA,UAAKZ,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACK,MAAtB;;EACA,UAAKE,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACI,QAAtB;;EAEA,UAAKwD,IAAL,CAAUC,GAAV,GAAgBC,MAAM,CAACC,qBAAP,CAA6B;EAAA,aAAM,MAAKC,gBAAL,EAAN;EAAA,KAA7B,CAAhB;;EAEA,UAAKC,IAAL;;EAvDkB;EAwDnB;EAED;EACF;EACA;;;EA9DA;;EAAA,SA+DE5C,OA/DF,GA+DE,mBAAU;EAAA;;EACR,SAAKb,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiBmB,eAA9B,EAA+C,IAA/C;EACA,SAAKZ,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACK,MAAvB,EAA+B,IAA/B;EACA,SAAKE,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACI,QAAvB,EAAiC,IAAjC;EAEA,SAAKkD,MAAL,CAAYjC,OAAZ;EACA,+BAAKuC,IAAL,CAAUM,OAAV,wCAAmBD,IAAnB;EACAH,IAAAA,MAAM,CAACK,oBAAP,CAA4B,KAAKP,IAAL,CAAUC,GAAtC;EAEA,WAAO,KAAKD,IAAL,CAAUM,OAAjB;EACA,WAAO,KAAKZ,MAAZ;EACA,WAAO,KAAK/C,MAAZ;;EAEA,iCAAMc,OAAN;EACD;EAED;EACF;EACA;EAjFA;;EAAA,SAkFEE,WAlFF,GAkFE,qBAAYC,CAAZ,EAAe;EACb;EACA,YAAQA,CAAC,CAACC,IAAV;EACE,WAAKP,2BAAS,CAAClB,MAAV,CAAiBmB,eAAtB;EACA,WAAKnB,MAAM,CAACK,MAAZ;EACA,WAAKL,MAAM,CAACI,QAAZ;EACE,aAAK+C,SAAL,CAAeiB,KAAf,CAAqBC,KAArB,GAAgC,KAAK9D,MAAL,CAAY+D,iBAAZ,KAAkC,GAAlE;EACA;EALJ;EAOA;;EACD;EAED;EACF;EACA;EAhGA;;EAAA,SAiGEN,gBAjGF,GAiGE,4BAAmB;EAAA;;EACjB,SAAKZ,WAAL,CAAiBgB,KAAjB,CAAuBC,KAAvB,GAAkC,KAAK9D,MAAL,CAAYgE,WAAZ,KAA4B,GAA9D;EAEA,SAAKX,IAAL,CAAUC,GAAV,GAAgBC,MAAM,CAACC,qBAAP,CAA6B;EAAA,aAAM,MAAI,CAACC,gBAAL,EAAN;EAAA,KAA7B,CAAhB;EACD;EAED;EACF;EACA;EAzGA;;EAAA,SA0GEL,gBA1GF,GA0GE,0BAAiBnC,CAAjB,EAAoB;EAClB,QAAIA,CAAC,CAACgD,SAAN,EAAiB;EACf,WAAKnB,SAAL,CAAee,KAAf,CAAqBK,OAArB,GAA+B,OAA/B;EACA,WAAKpB,SAAL,CAAee,KAAf,CAAqBM,IAArB,GAA+BlD,CAAC,CAACmD,KAAF,GAAU,GAAzC;EAEA,UAAM/B,IAAI,GAAGD,UAAU,CAAC,KAAKpC,MAAL,CAAYqE,WAAZ,KAA4BpD,CAAC,CAACmD,KAA/B,CAAvB;;EAEA,UAAI,CAAC,KAAKf,IAAL,CAAUM,OAAf,EAAwB;EACtB,aAAKN,IAAL,CAAUM,OAAV,GAAoB,KAAK1D,GAAL,CAAS0D,OAAT,CAAiBW,MAAjB,CAAwB;EAC1CC,UAAAA,GAAG,EAAMtD,CAAC,CAACuD,MAAF,CAASC,OADwB;EAE1CN,UAAAA,IAAI,EAAKlD,CAAC,CAACuD,MAAF,CAASE,OAFwB;EAG1CC,UAAAA,OAAO,EAAEtC;EAHiC,SAAxB,CAApB;EAKD,OAND,MAOK;EACH,aAAKgB,IAAL,CAAUM,OAAV,CAAkBgB,OAAlB,CAA0BrE,SAA1B,GAAsC+B,IAAtC;EACA,aAAKgB,IAAL,CAAUM,OAAV,CAAkBiB,IAAlB,CAAuB;EACrBL,UAAAA,GAAG,EAAGtD,CAAC,CAACuD,MAAF,CAASC,OADM;EAErBN,UAAAA,IAAI,EAAElD,CAAC,CAACuD,MAAF,CAASE;EAFM,SAAvB;EAID;EACF,KApBD,MAqBK;EAAA;;EACH,WAAK5B,SAAL,CAAee,KAAf,CAAqBK,OAArB,GAA+B,MAA/B;EAEA,kCAAKb,IAAL,CAAUM,OAAV,yCAAmBD,IAAnB;EACA,aAAO,KAAKL,IAAL,CAAUM,OAAjB;EACD;;EACD,QAAI1C,CAAC,CAAC4D,KAAN,EAAa;EACX,WAAK7E,MAAL,CAAY8E,WAAZ,CAAwB7D,CAAC,CAACmD,KAA1B;EACD;EACF,GAzIH;;EAAA;EAAA,EAAiC7C,mCAAjC;;ECHA;EACA;EACA;EACA;EACA;;MACawD,WAAb;EAAA;;EAKE;EACF;EACA;EACE,uBAAYtD,MAAZ,EAAoB;EAAA;;EAClB,0CAAMA,MAAN,EAAc,4BAAd;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAKkD,OAAL,GAAexE,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf;EACA,UAAKuE,OAAL,CAAatE,SAAb,GAAyB,qBAAzB;;EACA,UAAKG,SAAL,CAAeC,WAAf,CAA2B,MAAKkE,OAAhC;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAK3E,MAAL,GAAc,MAAKC,GAAL,CAASyB,SAAT,CAAmB,OAAnB,CAAd;;EAEA,QAAI,MAAK1B,MAAT,EAAiB;EACf,YAAKC,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiBmB,eAA7B;;EACA,YAAKZ,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACI,QAAtB;EACD;;EAtBiB;EAuBnB;EAED;EACF;EACA;;;EAnCA;;EAAA,SAoCEiB,OApCF,GAoCE,mBAAU;EACR,QAAI,KAAKd,MAAT,EAAiB;EACf,WAAKC,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiBmB,eAA9B,EAA+C,IAA/C;EACA,WAAKZ,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACI,QAAvB,EAAiC,IAAjC;EACD;;EAED,WAAO,KAAKG,MAAZ;;EAEA,iCAAMc,OAAN;EACD;EAED;EACF;EACA;EACA;EACA;EAnDA;;EAAA,SAoDEE,WApDF,GAoDE,qBAAYC,CAAZ,EAAe;EACb;EACA,YAAQA,CAAC,CAACC,IAAV;EACE,WAAKP,2BAAS,CAAClB,MAAV,CAAiBmB,eAAtB;EACA,WAAKnB,MAAM,CAACI,QAAZ;EACE,aAAK8E,OAAL,CAAarE,SAAb,gBAAoC8B,UAAU,CAAC,KAAKpC,MAAL,CAAYgF,OAAZ,EAAD,CAA9C,oBAAoF5C,UAAU,CAAC,KAAKpC,MAAL,CAAYqE,WAAZ,EAAD,CAA9F;EACA;EAJJ;EAMA;;EACD,GA7DH;;EAAA;EAAA,EAAiC9C,mCAAjC;EAAawD,YAEJhD,KAAK;EAFDgD,YAGJ/C,UAAU;;;;ECRnB;EACA;EACA;EACA;EACA;;MACaiD,YAAb;EAAA;;EAME;EACF;EACA;EACE,wBAAYxD,MAAZ,EAAoB;EAAA;;EAClB,uCAAMA,MAAN,EAAc,iDAAd,EAAiE,IAAjE;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAKzB,MAAL,GAAc,MAAKC,GAAL,CAASyB,SAAT,CAAmB,OAAnB,CAAd;EAEA;EACJ;EACA;EACA;EACA;;EACI,UAAKwD,cAAL,GAAsB/E,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAtB;EACA,UAAK8E,cAAL,CAAoB7E,SAApB,GAAgC,6BAAhC;;EACA,UAAKG,SAAL,CAAeC,WAAf,CAA2B,MAAKyE,cAAhC;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKC,KAAL,GAAahF,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAb;EACA,UAAK+E,KAAL,CAAW9E,SAAX,GAAuB,yBAAvB;;EACA,UAAK6E,cAAL,CAAoBzE,WAApB,CAAgC,MAAK0E,KAArC;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKC,QAAL,GAAgBjF,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAhB;EACA,UAAKgF,QAAL,CAAc/E,SAAd,GAA0B,yBAA1B;;EACA,UAAK8E,KAAL,CAAW1E,WAAX,CAAuB,MAAK2E,QAA5B;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKvC,WAAL,GAAmB1C,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAnB;EACA,UAAKyC,WAAL,CAAiBxC,SAAjB,GAA6B,4BAA7B;;EACA,UAAK8E,KAAL,CAAW1E,WAAX,CAAuB,MAAKoC,WAA5B;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKC,SAAL,GAAiB3C,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;EACA,UAAK0C,SAAL,CAAezC,SAAf,GAA2B,0BAA3B;;EACA,UAAK8E,KAAL,CAAW1E,WAAX,CAAuB,MAAKqC,SAA5B;EAEA;EACJ;EACA;EACA;EACA;;;EACI,UAAKC,MAAL,GAAc,IAAI5B,uBAAK,CAAC6B,MAAV,CAAiB;EAC7B/C,MAAAA,GAAG,EAAQ,MAAKA,GADa;EAE7BO,MAAAA,SAAS,EAAE,MAAK2E,KAFa;EAG7BlC,MAAAA,SAAS,EAAE9B,uBAAK,CAAC6B,MAAN,CAAaqC,QAHK;EAI7BlC,MAAAA,QAAQ,EAAG,kBAAAlC,CAAC;EAAA,eAAI,MAAKmC,gBAAL,CAAsBnC,CAAtB,CAAJ;EAAA;EAJiB,KAAjB,CAAd;;EAOA,QAAI,MAAKjB,MAAT,EAAiB;EACf,YAAKC,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiBmB,eAA7B;;EACA,YAAKZ,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACC,IAAtB;;EACA,YAAKM,MAAL,CAAYU,EAAZ,CAAejB,MAAM,CAACG,aAAtB;;EAEA,YAAK0F,WAAL,CAAiB,CAAjB;EACD;;EAzEiB;EA0EnB;EAED;EACF;EACA;;;EAvFA;;EAAA,SAwFExE,OAxFF,GAwFE,mBAAU;EACR,QAAI,KAAKd,MAAT,EAAiB;EACf,WAAKC,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiBmB,eAA9B,EAA+C,IAA/C;EACA,WAAKZ,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACC,IAAvB,EAA6B,IAA7B;EACA,WAAKM,MAAL,CAAYe,GAAZ,CAAgBtB,MAAM,CAACG,aAAvB,EAAsC,IAAtC;EACD;;EAED,SAAKmD,MAAL,CAAYjC,OAAZ;EAEA,WAAO,KAAKd,MAAZ;;EAEA,8BAAMc,OAAN;EACD;EAED;EACF;EACA;EAxGA;;EAAA,SAyGEa,WAzGF,GAyGE,uBAAc;EACZ,WAAO,CAAC,CAAC,KAAK3B,MAAd;EACD;EAED;EACF;EACA;EACA;EACA;EAjHA;;EAAA,SAkHEgB,WAlHF,GAkHE,qBAAYC,CAAZ,EAAe;EACb;EACA,YAAQA,CAAC,CAACC,IAAV;EACE,WAAKP,2BAAS,CAAClB,MAAV,CAAiBmB,eAAtB;EACA,WAAKnB,MAAM,CAACC,IAAZ;EACA,WAAKD,MAAM,CAACG,aAAZ;EACE,aAAK0F,WAAL,CAAiB,KAAKtF,MAAL,CAAYuF,SAAZ,EAAjB;;EACA;EALJ;EAOA;;EACD;EAED;EACF;EACA;EACA;EAjIA;;EAAA,SAkIE1D,OAlIF,GAkIE,mBAAU;EACR,SAAK7B,MAAL,CAAYwF,OAAZ;EACD;EAED;EACF;EACA;EAxIA;;EAAA,SAyIEpC,gBAzIF,GAyIE,0BAAiBnC,CAAjB,EAAoB;EAClB,QAAIA,CAAC,CAACwE,SAAN,EAAiB;EACf,WAAKzF,MAAL,CAAY0F,SAAZ,CAAsBzE,CAAC,CAACmD,KAAxB;EACD;EACF;EAED;EACF;EACA;EAjJA;;EAAA,SAkJEkB,WAlJF,GAkJE,qBAAYK,MAAZ,EAAoB;EAClB,QAAIC,KAAJ;EACA,QAAID,MAAM,KAAK,CAAf,EAAkBC,KAAK,GAAG,CAAR,CAAlB,KACK,IAAID,MAAM,GAAG,KAAb,EAAoBC,KAAK,GAAG,CAAR,CAApB,KACA,IAAID,MAAM,GAAG,KAAb,EAAoBC,KAAK,GAAG,CAAR,CAApB,KACAA,KAAK,GAAG,CAAR;EAELzE,IAAAA,uBAAK,CAACC,WAAN,CAAkB,KAAKZ,SAAvB,EAAkC,4BAAlC,EAAgEoF,KAAK,KAAK,CAA1E;EACAzE,IAAAA,uBAAK,CAACC,WAAN,CAAkB,KAAKZ,SAAvB,EAAkC,4BAAlC,EAAgEoF,KAAK,KAAK,CAA1E;EACAzE,IAAAA,uBAAK,CAACC,WAAN,CAAkB,KAAKZ,SAAvB,EAAkC,4BAAlC,EAAgEoF,KAAK,KAAK,CAA1E;EACAzE,IAAAA,uBAAK,CAACC,WAAN,CAAkB,KAAKZ,SAAvB,EAAkC,4BAAlC,EAAgEoF,KAAK,KAAK,CAA1E;EAEA,SAAK9C,SAAL,CAAee,KAAf,CAAqBgC,MAArB,GAAiCF,MAAM,GAAG,GAA1C;EACA,SAAK9C,WAAL,CAAiBgB,KAAjB,CAAuBiC,MAAvB,GAAmCH,MAAM,GAAG,GAA5C;EACD,GAhKH;;EAAA;EAAA,EAAkC7D,gCAAlC;EAAamD,aAEJlD,KAAK;EAFDkD,aAGJjD,UAAU;EAHNiD,aAIJhD,OAAO8D;;ECFhB;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EAGA;;AACAC,4BAAQ,CAACC,IAAT,CAAczE,eAAe,CAACO,EAA9B,IAAoC,YAApC;AACAiE,4BAAQ,CAACC,IAAT,CAAchB,YAAY,CAAClD,EAA3B,IAAiC,QAAjC;AACAmE,kCAAc,CAAC1E,eAAD,CAAd;AACA0E,kCAAc,CAACjB,YAAD,CAAd;AACAiB,kCAAc,CAACnB,WAAD,CAAd;AACAiB,4BAAQ,CAACvE,MAAT,CAAgB0E,OAAhB,CAAwB3E,eAAe,CAACQ,OAAxC;EAMA;EACA;EACA;EACA;EACA;;MACaoE,WAAb;EAAA;;EAME;EACF;EACA;EACA;EACE,uBAAYnG,GAAZ,EAAiBoG,OAAjB,EAA0B;EAAA;;EACxB,uCAAMpG,GAAN;;EAEA,QAAI,CAAC,MAAKA,GAAL,CAASqG,OAAT,CAAiBC,WAAjB,CAA6BxE,EAA7B,CAAgCyE,QAAhC,CAAyC,OAAzC,CAAL,EAAwD;EACtD,YAAM,IAAIC,0BAAJ,CAAa,oDAAb,CAAN;EACD;EAED;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;;;EACI,UAAKC,UAAL,GAAkB;EAChBC,MAAAA,KAAK,EAAM,IADK;EAEhBC,MAAAA,KAAK,EAAM,IAFK;EAGhBC,MAAAA,GAAG,EAAQ,IAHK;EAIhBC,MAAAA,SAAS,EAAE;EAJK,KAAlB;EAOA;EACJ;EACA;EACA;;EACI,UAAKC,MAAL;EACEC,MAAAA,WAAW,EAAE,IADf;EAEEC,MAAAA,SAAS,EAAI;EAFf,OAGKZ,OAHL;;EAMA,QAAI,MAAKU,MAAL,CAAYC,WAAhB,EAA6B;EAC3B,YAAKA,WAAL,GAAmB,IAAIrE,WAAJ,+BAAnB;EACD;;EAED,QAAI,MAAKoE,MAAL,CAAYE,SAAhB,EAA2B;EACzB,YAAKC,OAAL,GAAe,IAAInH,YAAJ,+BAAf;EACD;EAED;EACJ;EACA;EACA;;;EACI,UAAKoH,OAAL,GAAe,IAAf;EA5CwB;EA6CzB;EAED;EACF;EACA;;;EA3DA;;EAAA,SA4DEC,IA5DF,GA4DE,gBAAO;EACL,8BAAMA,IAAN;;EAEA,SAAKD,OAAL,GAAe,KAAKlH,GAAL,CAASyB,SAAT,CAAmB,SAAnB,CAAf;;EAEA,QAAI,KAAKqF,MAAL,CAAYD,SAAhB,EAA2B;EACzB,WAAKO,YAAL,CAAkB,KAAKN,MAAL,CAAYD,SAA9B;EACA,aAAO,KAAKC,MAAL,CAAYD,SAAnB;EACD;;EAED,SAAK7G,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiB6H,UAA7B,EAAyC,IAAzC;EACA,SAAKrH,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiB8H,aAA7B,EAA4C,IAA5C;EACA,SAAKtH,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiBmB,eAA7B,EAA8C,IAA9C;EACA,SAAKX,GAAL,CAASS,EAAT,CAAYC,2BAAS,CAAClB,MAAV,CAAiB+H,SAA7B,EAAwC,IAAxC;EACD;EAED;EACF;EACA;EA9EA;;EAAA,SA+EE1G,OA/EF,GA+EE,mBAAU;EACR,SAAKb,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiB6H,UAA9B,EAA0C,IAA1C;EACA,SAAKrH,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiB8H,aAA9B,EAA6C,IAA7C;EACA,SAAKtH,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiBmB,eAA9B,EAA+C,IAA/C;EACA,SAAKX,GAAL,CAASc,GAAT,CAAaJ,2BAAS,CAAClB,MAAV,CAAiB+H,SAA9B,EAAyC,IAAzC;EAEA,WAAO,KAAKd,UAAZ;EACA,WAAO,KAAKM,WAAZ;EACA,WAAO,KAAKE,OAAZ;;EAEA,8BAAMpG,OAAN;EACD;EAED;EACF;EACA;EA9FA;;EAAA,SA+FEE,WA/FF,GA+FE,qBAAYC,CAAZ,EAAe;EAAA;;EACb;EACA;EACA,YAAQA,CAAC,CAACC,IAAV;EACE,WAAKP,2BAAS,CAAClB,MAAV,CAAiB8H,aAAtB;EACE,aAAKE,YAAL;;EACA;;EACF,WAAK9G,2BAAS,CAAClB,MAAV,CAAiB6H,UAAtB;EACE,aAAKI,qBAAL;;EACA;;EACF,WAAK/G,2BAAS,CAAClB,MAAV,CAAiBmB,eAAtB;EACE,aAAK+G,WAAL,CAAiB1G,CAAC,CAAC2G,IAAF,CAAO,CAAP,CAAjB;;EACA,kCAAKZ,WAAL,uCAAkBa,IAAlB;EACA;;EACF,WAAKlH,2BAAS,CAAClB,MAAV,CAAiB+H,SAAtB;EACE,aAAKM,YAAL,CAAkB7G,CAAlB,EAAqBA,CAAC,CAAC2G,IAAF,CAAO,CAAP,CAArB;;EACA;;EACF,WAAK,MAAL;EAAqB,aAAKG,OAAL,CAAatI,MAAM,CAACC,IAApB;EAA2B;;EAChD,WAAK,OAAL;EAAqB,aAAKqI,OAAL,CAAatI,MAAM,CAACE,KAApB;EAA4B;;EACjD,WAAK,UAAL;EAAqB,aAAKoI,OAAL,CAAatI,MAAM,CAACK,MAApB,EAA4B,KAAKiE,iBAAL,EAA5B;EAAuD;;EAC5E,WAAK,cAAL;EAAqB,aAAKgE,OAAL,CAAatI,MAAM,CAACG,aAApB,EAAmC,KAAK2F,SAAL,EAAnC;EAAsD;;EAC3E,WAAK,YAAL;EACE,aAAKwC,OAAL,CAAatI,MAAM,CAACI,QAApB,EAA8B;EAC5BwC,UAAAA,IAAI,EAAM,KAAK2C,OAAL,EADkB;EAE5BgD,UAAAA,QAAQ,EAAE,KAAK3D,WAAL,EAFkB;EAG5B4D,UAAAA,QAAQ,EAAE,KAAKjE,WAAL;EAHkB,SAA9B;EAKA;EAxBJ,KAHa;;EA8Bb;;EACD;EAED;EACF;EACA;EAlIA;;EAAA,SAmIE2D,WAnIF,GAmIE,qBAAYO,WAAZ,EAAyB;EACvB,SAAKC,KAAL,GAAaD,WAAW,CAACE,OAAZ,CAAoBC,KAAjC;EAEA,SAAKF,KAAL,CAAWtH,gBAAX,CAA4B,MAA5B,EAAoC,IAApC;EACA,SAAKsH,KAAL,CAAWtH,gBAAX,CAA4B,OAA5B,EAAqC,IAArC;EACA,SAAKsH,KAAL,CAAWtH,gBAAX,CAA4B,UAA5B,EAAwC,IAAxC;EACA,SAAKsH,KAAL,CAAWtH,gBAAX,CAA4B,cAA5B,EAA4C,IAA5C;EACA,SAAKsH,KAAL,CAAWtH,gBAAX,CAA4B,YAA5B,EAA0C,IAA1C;EACD;EAED;EACF;EACA;EA/IA;;EAAA,SAgJEiH,YAhJF,GAgJE,sBAAa7G,CAAb,EAAgBqH,GAAhB,EAAqB;EACnB,QAAIA,GAAG,KAAK3H,2BAAS,CAAC4H,SAAV,CAAoBC,KAAhC,EAAuC;EACrC,WAAKlH,SAAL;EACAL,MAAAA,CAAC,CAACwH,cAAF;EACD;EACF;EAED;EACF;EACA;EACA;EA1JA;;EAAA,SA2JEpE,WA3JF,GA2JE,uBAAc;EAAA;;EACZ,kDAAO,KAAK8D,KAAZ,qBAAO,YAAYH,QAAnB,mCAA+B,CAA/B;EACD;EAED;EACF;EACA;EACA;EAlKA;;EAAA,SAmKEhD,OAnKF,GAmKE,mBAAU;EAAA;;EACR,oDAAO,KAAKmD,KAAZ,qBAAO,aAAYO,WAAnB,oCAAkC,CAAlC;EACD;EAED;EACF;EACA;EACA;EA1KA;;EAAA,SA2KE1E,WA3KF,GA2KE,uBAAc;EACZ,WAAO,KAAKmE,KAAL,GAAa,KAAKA,KAAL,CAAWO,WAAX,GAAyB,KAAKP,KAAL,CAAWH,QAAjD,GAA4D,CAAnE;EACD;EAED;EACF;EACA;EACA;EAlLA;;EAAA,SAmLE3G,SAnLF,GAmLE,qBAAY;EACV,WAAO,KAAK8G,KAAL,GAAa,CAAC,KAAKA,KAAL,CAAWQ,MAAzB,GAAkC,KAAzC;EACD;EAED;EACF;EACA;EACA;EA1LA;;EAAA,SA2LEpD,SA3LF,GA2LE,qBAAY;EAAA;;EACV,WAAO,qBAAK4C,KAAL,0BAAYS,KAAZ,GAAoB,CAApB,yCAAwB,KAAKT,KAA7B,qBAAwB,aAAYxC,MAApC,iCAA8C,CAArD;EACD;EAED;EACF;EACA;EAjMA;;EAAA,SAkMErE,SAlMF,GAkME,qBAAY;EACV,QAAI,KAAK6G,KAAT,EAAgB;EACd,UAAI,KAAKA,KAAL,CAAWQ,MAAf,EAAuB;EACrB,aAAKR,KAAL,CAAWU,IAAX;EACD,OAFD,MAGK;EACH,aAAKV,KAAL,CAAWW,KAAX;EACD;EACF;EACF;EAED;EACF;EACA;EA/MA;;EAAA,SAgNED,IAhNF,GAgNE,gBAAO;EACL,QAAI,KAAKV,KAAL,IAAc,KAAKA,KAAL,CAAWQ,MAA7B,EAAqC;EACnC,WAAKR,KAAL,CAAWU,IAAX;EACD;EACF;EAED;EACF;EACA;EAxNA;;EAAA,SAyNEC,KAzNF,GAyNE,iBAAQ;EACN,QAAI,KAAKX,KAAL,IAAc,CAAC,KAAKA,KAAL,CAAWQ,MAA9B,EAAsC;EACpC,WAAKR,KAAL,CAAWW,KAAX;EACD;EACF;EAED;EACF;EACA;EACA;EAlOA;;EAAA,SAmOEpD,SAnOF,GAmOE,mBAAUC,MAAV,EAAkB;EAChB,QAAI,KAAKwC,KAAT,EAAgB;EACd,WAAKA,KAAL,CAAWS,KAAX,GAAmB,KAAnB;EACA,WAAKT,KAAL,CAAWxC,MAAX,GAAoBA,MAApB;EACD;EACF;EAED;EACF;EACA;EACA;EA7OA;;EAAA,SA8OEH,OA9OF,GA8OE,iBAAQuD,IAAR,EAAc;EACZ,QAAI,KAAKZ,KAAT,EAAgB;EACd,WAAKA,KAAL,CAAWS,KAAX,GAAmBG,IAAI,KAAKC,SAAT,GAAqB,CAAC,KAAKb,KAAL,CAAWS,KAAjC,GAAyCG,IAA5D;;EACA,UAAI,CAAC,KAAKZ,KAAL,CAAWS,KAAZ,IAAqB,KAAKT,KAAL,CAAWxC,MAAX,KAAsB,CAA/C,EAAkD;EAChD,aAAKwC,KAAL,CAAWxC,MAAX,GAAoB,GAApB;EACD;EACF;EACF;EAED;EACF;EACA;EACA;EA1PA;;EAAA,SA2PEsD,OA3PF,GA2PE,iBAAQ5G,IAAR,EAAc;EACZ,QAAI,KAAK8F,KAAT,EAAgB;EACd,WAAKA,KAAL,CAAWO,WAAX,GAAyBrG,IAAzB;EACD;EACF;EAED;EACF;EACA;EACA;EApQA;;EAAA,SAqQEyC,WArQF,GAqQE,qBAAYmD,QAAZ,EAAsB;EACpB,QAAI,KAAKE,KAAT,EAAgB;EACd,WAAKA,KAAL,CAAWO,WAAX,GAAyB,KAAKP,KAAL,CAAWH,QAAX,GAAsBC,QAA/C;EACD;EACF,GAzQH;;EAAA,SA2QElE,iBA3QF,GA2QE,6BAAoB;EAClB,QAAI,KAAKoE,KAAT,EAAgB;EACd,UAAIe,SAAS,GAAG,CAAhB;EAEA,UAAMC,MAAM,GAAG,KAAKhB,KAAL,CAAWiB,QAA1B;;EAEA,WAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGH,MAAM,CAACI,MAA3B,EAAmCF,CAAC,GAAGC,CAAvC,EAA0CD,CAAC,EAA3C,EAA+C;EAC7C,YAAIF,MAAM,CAACvC,KAAP,CAAayC,CAAb,KAAmB,KAAKlB,KAAL,CAAWO,WAA9B,IAA6CS,MAAM,CAACtC,GAAP,CAAWwC,CAAX,KAAiB,KAAKlB,KAAL,CAAWO,WAA7E,EAA0F;EACxFQ,UAAAA,SAAS,GAAGC,MAAM,CAACtC,GAAP,CAAWwC,CAAX,CAAZ;EACA;EACD;EACF;;EAED,aAAO9G,IAAI,CAACiH,GAAL,CAAS,KAAKrB,KAAL,CAAWO,WAApB,EAAiCQ,SAAjC,IAA8C,KAAKf,KAAL,CAAWH,QAAhE;EACD,KAbD,MAcK;EACH,aAAO,CAAP;EACD;EACF;EAED;EACF;EACA;EACA;EAlSA;;EAAA,SAmSEX,YAnSF,GAmSE,sBAAaP,SAAb,EAAwB;EAAA;;EACtB,QAAIA,SAAS,IAAIA,SAAS,CAACyC,MAAV,GAAmB,CAApC,EAAuC;EACrC,YAAM,IAAI9C,0BAAJ,CAAa,kCAAb,CAAN;EACD;;EAED,SAAKC,UAAL,CAAgBI,SAAhB,GAA4B3F,uBAAK,CAACsI,KAAN,CAAY3C,SAAZ,CAA5B;;EAEA,QAAI,KAAKJ,UAAL,CAAgBI,SAApB,EAA+B;EAC7B,WAAKJ,UAAL,CAAgBI,SAAhB,CAA0B4C,OAA1B,CAAkC,UAACC,EAAD,EAAKN,CAAL,EAAW;EAC3C,YAAIM,EAAE,CAACC,QAAP,EAAiB;EACf,cAAMA,QAAQ,GAAG,MAAI,CAAC3J,GAAL,CAAS4J,UAAT,CAAoBC,aAApB,CAAkCH,EAAE,CAACC,QAArC,CAAjB;;EACAD,UAAAA,EAAE,CAACC,QAAH,GAAc,CAACA,QAAQ,CAACG,SAAV,EAAqBH,QAAQ,CAACI,QAA9B,CAAd;EACD,SAHD,MAIK;EACH,gBAAM,IAAIvD,0BAAJ,gBAA0B4C,CAA1B,oCAAN;EACD;;EAED,YAAIlI,uBAAK,CAAC8I,KAAN,CAAYN,EAAE,CAACtH,IAAf,CAAJ,EAA0B;EACxB,gBAAM,IAAIoE,0BAAJ,gBAA0B4C,CAA1B,sBAAN;EACD;EACF,OAZD;EAcA,WAAK3C,UAAL,CAAgBI,SAAhB,CAA0BoD,IAA1B,CAA+B,UAACC,CAAD,EAAIC,CAAJ;EAAA,eAAUD,CAAC,CAAC9H,IAAF,GAAS+H,CAAC,CAAC/H,IAArB;EAAA,OAA/B;EACD;;EAED,SAAKqF,qBAAL;EACD;EAED;EACF;EACA;EAjUA;;EAAA,SAkUEA,qBAlUF,GAkUE,iCAAwB;EACtB,WAAO,KAAKhB,UAAL,CAAgBC,KAAvB;EACA,WAAO,KAAKD,UAAL,CAAgBE,KAAvB;EACA,WAAO,KAAKF,UAAL,CAAgBG,GAAvB;;EAEA,QAAI,KAAK5G,GAAL,CAASoK,mBAAT,MAAkC,KAAK3D,UAAL,CAAgBI,SAAtD,EAAiE;EAC/D;EACA,WAAK7G,GAAL,CAASqK,QAAT,CAAkBV,QAAlB,CAA2BW,IAA3B;EACD;EACF;EAED;EACF;EACA;EA/UA;;EAAA,SAgVE9C,YAhVF,GAgVE,wBAAe;EACb,QAAI,CAAC,KAAKxH,GAAL,CAASoK,mBAAT,EAAD,IAAmC,CAAC,KAAK3D,UAAL,CAAgBI,SAAxD,EAAmE;EACjE;EACD;;EAED,QAAM4B,WAAW,GAAG,KAAK1D,OAAL,EAApB;EACA,QAAM0B,UAAU,GAAG,KAAKA,UAAxB;;EAEA,QAAI,CAACA,UAAU,CAACC,KAAZ,IAAqB+B,WAAW,GAAGhC,UAAU,CAACE,KAAX,CAAiBvE,IAApD,IAA4DqG,WAAW,IAAIhC,UAAU,CAACG,GAAX,CAAexE,IAA9F,EAAoG;EAClG,WAAKmI,gBAAL,CAAsB9B,WAAtB;EACD;;EAED,QAAIhC,UAAU,CAACE,KAAX,KAAqBF,UAAU,CAACG,GAApC,EAAyC;EACvC,WAAK5G,GAAL,CAASwK,MAAT,CAAgB;EACdV,QAAAA,SAAS,EAAErD,UAAU,CAACE,KAAX,CAAiBgD,QAAjB,CAA0B,CAA1B,CADG;EAEdI,QAAAA,QAAQ,EAAGtD,UAAU,CAACE,KAAX,CAAiBgD,QAAjB,CAA0B,CAA1B;EAFG,OAAhB;EAID,KALD,MAMK;EACH,UAAM3B,QAAQ,GAAG,CAACS,WAAW,GAAGhC,UAAU,CAACE,KAAX,CAAiBvE,IAAhC,KAAyCqE,UAAU,CAACG,GAAX,CAAexE,IAAf,GAAsBqE,UAAU,CAACE,KAAX,CAAiBvE,IAAhF,CAAjB,CADG;;EAGH,UAAMsH,EAAE,GAAGjD,UAAU,CAACC,KAAX,CAAiB+D,QAAjB,CAA0B,IAAI,CAAJ,GAAQzC,QAAQ,GAAG,CAA7C,CAAX;EAEA,WAAKhI,GAAL,CAASqK,QAAT,CAAkBV,QAAlB,CAA2Be,IAA3B,CAAgC;EAC9BZ,QAAAA,SAAS,EAAEJ,EAAE,CAACiB,CADgB;EAE9BZ,QAAAA,QAAQ,EAAGL,EAAE,CAACkB;EAFgB,OAAhC;EAID;EACF;EAED;EACF;EACA;EAhXA;;EAAA,SAiXEL,gBAjXF,GAiXE,0BAAiB9B,WAAjB,EAA8B;EAC5B,QAAIoC,EAAE,GAAG,IAAT;EACA,QAAIC,EAAE,GAAG,IAAT;EAEA,QAAMjE,SAAS,GAAG,KAAKJ,UAAL,CAAgBI,SAAlC;EACA,QAAMwC,CAAC,GAAGxC,SAAS,CAACyC,MAAV,GAAmB,CAA7B;;EAEA,QAAIb,WAAW,GAAG5B,SAAS,CAAC,CAAD,CAAT,CAAazE,IAA/B,EAAqC;EACnCyI,MAAAA,EAAE,GAAG,CAAL;EACAC,MAAAA,EAAE,GAAG,CAAL;EACD;;EACD,SAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,CAApB,EAAuBD,CAAC,EAAxB,EAA4B;EAC1B,UAAIX,WAAW,IAAI5B,SAAS,CAACuC,CAAD,CAAT,CAAahH,IAA5B,IAAoCqG,WAAW,GAAG5B,SAAS,CAACuC,CAAC,GAAG,CAAL,CAAT,CAAiBhH,IAAvE,EAA6E;EAC3EyI,QAAAA,EAAE,GAAGzB,CAAL;EACA0B,QAAAA,EAAE,GAAG1B,CAAC,GAAG,CAAT;EACA;EACD;EACF;;EACD,QAAIX,WAAW,IAAI5B,SAAS,CAACwC,CAAD,CAAT,CAAajH,IAAhC,EAAsC;EACpCyI,MAAAA,EAAE,GAAGxB,CAAL;EACAyB,MAAAA,EAAE,GAAGzB,CAAL;EACD,KArB2B;EAwB5B;;;EACA,QAAM0B,UAAU,GAAG,CACjBlE,SAAS,CAACvE,IAAI,CAACiH,GAAL,CAAS,CAAT,EAAYsB,EAAE,GAAG,CAAjB,CAAD,CAAT,CAA+BlB,QADd,EAEjB9C,SAAS,CAACgE,EAAD,CAAT,CAAclB,QAFG,EAGjB9C,SAAS,CAACiE,EAAD,CAAT,CAAcnB,QAHG,EAIjB9C,SAAS,CAACvE,IAAI,CAAC0I,GAAL,CAAS3B,CAAT,EAAYyB,EAAE,GAAG,CAAjB,CAAD,CAAT,CAA+BnB,QAJd,CAAnB,CAzB4B;;EAiC5B,QAAMsB,WAAW,GAAG,CAAC,IAAIC,aAAJ,CAAYH,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,CAAZ,EAA8BA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,CAA9B,CAAD,CAApB;EAEA,QAAII,CAAC,GAAG,CAAR;;EACA,SAAK,IAAI/B,EAAC,GAAG,CAAb,EAAgBA,EAAC,IAAI,CAArB,EAAwBA,EAAC,EAAzB,EAA6B;EAC3B,UAAMgC,CAAC,GAAGL,UAAU,CAAC3B,EAAC,GAAG,CAAL,CAAV,CAAkB,CAAlB,IAAuB2B,UAAU,CAAC3B,EAAD,CAAV,CAAc,CAAd,CAAjC;;EACA,UAAIgC,CAAC,GAAG9I,IAAI,CAAC+I,EAAb,EAAiB;EAAE;EACjBF,QAAAA,CAAC,IAAI,CAAL;EACD,OAFD,MAGK,IAAIC,CAAC,GAAG,CAAC9I,IAAI,CAAC+I,EAAd,EAAkB;EAAE;EACvBF,QAAAA,CAAC,IAAI,CAAL;EACD;;EACD,UAAIA,CAAC,KAAK,CAAN,IAAW/B,EAAC,KAAK,CAArB,EAAwB;EACtB;EACA6B,QAAAA,WAAW,CAAC,CAAD,CAAX,CAAeN,CAAf,IAAoBQ,CAAC,GAAG,CAAJ,GAAQ7I,IAAI,CAAC+I,EAAjC;EACAF,QAAAA,CAAC,GAAG,CAAJ;EACD;;EACDF,MAAAA,WAAW,CAACK,IAAZ,CAAiB,IAAIJ,aAAJ,CAAYH,UAAU,CAAC3B,EAAD,CAAV,CAAc,CAAd,IAAmB+B,CAAC,GAAG,CAAJ,GAAQ7I,IAAI,CAAC+I,EAA5C,EAAgDN,UAAU,CAAC3B,EAAD,CAAV,CAAc,CAAd,CAAhD,CAAjB;EACD;;EAED,SAAK3C,UAAL,CAAgBC,KAAhB,GAAwB,IAAI6E,iBAAJ,CAAgBN,WAAhB,CAAxB;EACA,SAAKxE,UAAL,CAAgBE,KAAhB,GAAwBE,SAAS,CAACgE,EAAD,CAAjC;EACA,SAAKpE,UAAL,CAAgBG,GAAhB,GAAsBC,SAAS,CAACiE,EAAD,CAA/B,CAtD4B;EAyD7B,GA1aH;;EAAA;EAAA,EAAiCU,gCAAjC;EAAarF,YAEJrE,KAAK;EAFDqE,YAIJ3G,SAASA;;;;;;;;;;;"}