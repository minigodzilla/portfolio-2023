{"version":3,"file":"markers.js","sources":["../../src/plugins/markers/constants.js","../../src/plugins/markers/utils.js","../../src/plugins/markers/Marker.js","../../src/plugins/markers/MarkersButton.js","../../src/plugins/markers/MarkersListButton.js","../../src/plugins/markers/index.js"],"sourcesContent":["import { utils } from '../..';\nimport icon from './pin-list.svg';\n\n/**\n * @summary Available events\n * @enum {string}\n * @memberof PSV.plugins.MarkersPlugin\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event marker-visibility\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the visibility of a marker changes\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @param {boolean} visible\n   */\n  MARKER_VISIBILITY  : 'marker-visibility',\n  /**\n   * @event goto-marker-done\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the animation to a marker is done\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  GOTO_MARKER_DONE   : 'goto-marker-done',\n  /**\n   * @event leave-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the user puts the cursor away from a marker\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  LEAVE_MARKER       : 'leave-marker',\n  /**\n   * @event over-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the user puts the cursor hover a marker\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  OVER_MARKER        : 'over-marker',\n  /**\n   * @event filter:render-markers-list\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Used to alter the list of markers displayed on the side-panel\n   * @param {PSV.plugins.MarkersPlugin.Marker[]} markers\n   * @returns {PSV.plugins.MarkersPlugin.Marker[]}\n   */\n  RENDER_MARKERS_LIST: 'render-markers-list',\n  /**\n   * @event select-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the user clicks on a marker. The marker can be retrieved from outside the event handler\n   * with {@link PSV.plugins.MarkersPlugin.getCurrentMarker}\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @param {PSV.plugins.MarkersPlugin.SelectMarkerData} data\n   */\n  SELECT_MARKER      : 'select-marker',\n  /**\n   * @event select-marker-list\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when a marker is selected from the side panel\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  SELECT_MARKER_LIST : 'select-marker-list',\n  /**\n   * @event unselect-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when a marker was selected and the user clicks elsewhere\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  UNSELECT_MARKER    : 'unselect-marker',\n  /**\n   * @event hide-markers\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the markers are hidden\n   */\n  HIDE_MARKERS       : 'hide-markers',\n  /**\n   * @event set-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the list of markers changes\n   * @param {PSV.plugins.MarkersPlugin.Marker[]} markers\n   */\n  SET_MARKERS        : 'set-markers',\n  /**\n   * @event show-markers\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the markers are shown\n   */\n  SHOW_MARKERS       : 'show-markers',\n};\n\n/**\n * @summary Types of tooltip events\n * @memberOf PSV.plugins.MarkersPlugin\n * @enum {string}\n * @constant\n * @private\n */\nexport const MARKER_TOOLTIP_TRIGGER = {\n  click: 'click',\n  hover: 'hover',\n};\n\n/**\n * @summary Namespace for SVG creation\n * @type {string}\n * @constant\n * @private\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * @summary Property name added to marker elements\n * @type {string}\n * @constant\n * @private\n */\nexport const MARKER_DATA = 'psvMarker';\n\n/**\n * @summary Panel identifier for marker content\n * @type {string}\n * @constant\n * @private\n */\nexport const ID_PANEL_MARKER = 'marker';\n\n/**\n * @summary Panel identifier for markers list\n * @type {string}\n * @constant\n * @private\n */\nexport const ID_PANEL_MARKERS_LIST = 'markersList';\n\nconst MARKER_DATA_KEY = utils.dasherize(MARKER_DATA);\n\n/**\n * @summary Markers list template\n * @param {PSV.plugins.MarkersPlugin.Marker[]} markers\n * @param {string} title\n * @returns {string}\n * @constant\n * @private\n */\nexport const MARKERS_LIST_TEMPLATE = (markers, title) => `\n<div class=\"psv-panel-menu psv-panel-menu--stripped\">\n  <h1 class=\"psv-panel-menu-title\">${icon} ${title}</h1>\n  <ul class=\"psv-panel-menu-list\">\n    ${markers.map(marker => `\n    <li data-${MARKER_DATA_KEY}=\"${marker.config.id}\" class=\"psv-panel-menu-item\" tabindex=\"0\">\n      ${marker.type === 'image' ? `<span class=\"psv-panel-menu-item-icon\"><img src=\"${marker.config.image}\"/></span>` : ''}\n      <span class=\"psv-panel-menu-item-label\">${marker.getListContent()}</span>\n    </li>\n    `).join('')}\n  </ul>\n</div>\n`;\n","import { CONSTANTS, utils } from '../..';\n\n/**\n * Returns intermediary point between two points on the sphere\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n * @param {number[]} p1\n * @param {number[]} p2\n * @param {number} f\n * @returns {number[]}\n * @private\n */\nexport function greatArcIntermediaryPoint(p1, p2, f) {\n  const [λ1, φ1] = p1;\n  const [λ2, φ2] = p2;\n\n  const r = utils.greatArcDistance(p1, p2);\n  const a = Math.sin((1 - f) * r) / Math.sin(r);\n  const b = Math.sin(f * r) / Math.sin(r);\n  const x = a * Math.cos(φ1) * Math.cos(λ1) + b * Math.cos(φ2) * Math.cos(λ2);\n  const y = a * Math.cos(φ1) * Math.sin(λ1) + b * Math.cos(φ2) * Math.sin(λ2);\n  const z = a * Math.sin(φ1) + b * Math.sin(φ2);\n\n  return [\n    Math.atan2(y, x),\n    Math.atan2(z, Math.sqrt(x * x + y * y)),\n  ];\n}\n\n/**\n * @summary Computes the center point of a polygon\n * @todo Get \"visual center\" (https://blog.mapbox.com/a-new-algorithm-for-finding-a-visual-center-of-a-polygon-7c77e6492fbc)\n * @param {number[][]} polygon\n * @returns {number[]}\n * @private\n */\nexport function getPolygonCenter(polygon) {\n  // apply offsets to avoid crossing the origin\n  const workPoints = [polygon[0]];\n\n  let k = 0;\n  for (let i = 1; i < polygon.length; i++) {\n    const d = polygon[i - 1][0] - polygon[i][0];\n    if (d > Math.PI) { // crossed the origin left to right\n      k += 1;\n    }\n    else if (d < -Math.PI) { // crossed the origin right to left\n      k -= 1;\n    }\n    workPoints.push([polygon[i][0] + k * 2 * Math.PI, polygon[i][1]]);\n  }\n\n  const sum = workPoints.reduce((intermediary, point) => [intermediary[0] + point[0], intermediary[1] + point[1]]);\n  return [utils.parseAngle(sum[0] / polygon.length), sum[1] / polygon.length];\n}\n\n/**\n * @summary Computes the middle point of a polyline\n * @param {number[][]} polyline\n * @returns {number[]}\n * @private\n */\nexport function getPolylineCenter(polyline) {\n  // compute each segment length + total length\n  let length = 0;\n  const lengths = [];\n\n  for (let i = 0; i < polyline.length - 1; i++) {\n    const l = utils.greatArcDistance(polyline[i], polyline[i + 1]) * CONSTANTS.SPHERE_RADIUS;\n\n    lengths.push(l);\n    length += l;\n  }\n\n  // iterate until length / 2\n  let consumed = 0;\n\n  for (let j = 0; j < polyline.length - 1; j++) {\n    // once the segment containing the middle point is found, computes the intermediary point\n    if (consumed + lengths[j] > length / 2) {\n      const r = (length / 2 - consumed) / lengths[j];\n      return greatArcIntermediaryPoint(polyline[j], polyline[j + 1], r);\n    }\n\n    consumed += lengths[j];\n  }\n\n  // this never happens\n  return polyline[Math.round(polyline.length / 2)];\n}\n","import { Group, MathUtils, Mesh, MeshBasicMaterial, PlaneGeometry, TextureLoader } from 'three';\nimport { CONSTANTS, PSVError, utils } from '../..';\nimport { MARKER_DATA, MARKER_TOOLTIP_TRIGGER, SVG_NS } from './constants';\nimport { getPolygonCenter, getPolylineCenter } from './utils';\n\n/**\n * @summary Types of marker\n * @memberOf PSV.plugins.MarkersPlugin\n * @enum {string}\n * @constant\n * @private\n */\nconst MARKER_TYPES = {\n  image      : 'image',\n  imageLayer : 'imageLayer',\n  html       : 'html',\n  polygonPx  : 'polygonPx',\n  polygonRad : 'polygonRad',\n  polylinePx : 'polylinePx',\n  polylineRad: 'polylineRad',\n  square     : 'square',\n  rect       : 'rect',\n  circle     : 'circle',\n  ellipse    : 'ellipse',\n  path       : 'path',\n};\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.Properties\n * @summary Marker properties, see {@link https://photo-sphere-viewer.js.org/plugins/plugin-markers.html#markers-options}\n */\n\n/**\n * @summary Object representing a marker\n * @memberOf PSV.plugins.MarkersPlugin\n */\nexport class Marker {\n\n  /**\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {PSV.Viewer} psv\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  constructor(properties, psv) {\n    if (!properties.id) {\n      throw new PSVError('missing marker id');\n    }\n\n    /**\n     * @member {PSV.Viewer}\n     * @readonly\n     * @protected\n     */\n    this.psv = psv;\n\n    /**\n     * @member {string}\n     * @readonly\n     */\n    this.id = properties.id;\n\n    /**\n     * @member {string}\n     * @readonly\n     */\n    this.type = Marker.getType(properties, false);\n\n    /**\n     * @member {boolean}\n     * @protected\n     */\n    this.visible = true;\n\n    /**\n     * @member {HTMLElement|SVGElement|THREE.Object3D}\n     * @readonly\n     */\n    this.$el = null;\n\n    /**\n     * @summary Original configuration of the marker\n     * @member {PSV.plugins.MarkersPlugin.Properties}\n     * @readonly\n     */\n    this.config = {};\n\n    /**\n     * @summary User data associated to the marker\n     * @member {any}\n     */\n    this.data = undefined;\n\n    /**\n     * @summary Tooltip instance for this marker\n     * @member {PSV.components.Tooltip}\n     */\n    this.tooltip = null;\n\n    /**\n     * @summary Computed properties\n     * @member {Object}\n     * @protected\n     * @property {boolean} dynamicSize\n     * @property {PSV.Point} anchor\n     * @property {boolean} visible - actually visible in the view\n     * @property {boolean} staticTooltip - the tooltip must always be shown\n     * @property {PSV.Position} position - position in spherical coordinates\n     * @property {PSV.Point} position2D - position in viewer coordinates\n     * @property {external:THREE.Vector3[]} positions3D - positions in 3D space\n     * @property {number} width\n     * @property {number} height\n     * @property {*} def\n     */\n    this.props = {\n      dynamicSize  : false,\n      anchor       : null,\n      visible      : false,\n      staticTooltip: false,\n      position     : null,\n      position2D   : null,\n      positions3D  : null,\n      width        : null,\n      height       : null,\n      def          : null,\n    };\n\n    /**\n     * @summary THREE file loader\n     * @type {THREE:TextureLoader}\n     * @private\n     */\n    this.loader = null;\n\n    if (this.is3d()) {\n      this.loader = new TextureLoader();\n      if (this.psv.config.withCredentials) {\n        this.loader.setWithCredentials(true);\n      }\n      if (this.psv.config.requestHeaders && typeof this.psv.config.requestHeaders === 'object') {\n        this.loader.setRequestHeader(this.psv.config.requestHeaders);\n      }\n    }\n\n    // create element\n    if (this.isNormal()) {\n      this.$el = document.createElement('div');\n    }\n    else if (this.isPolygon()) {\n      this.$el = document.createElementNS(SVG_NS, 'polygon');\n    }\n    else if (this.isPolyline()) {\n      this.$el = document.createElementNS(SVG_NS, 'polyline');\n    }\n    else if (this.isSvg()) {\n      const svgType = this.type === 'square' ? 'rect' : this.type;\n      this.$el = document.createElementNS(SVG_NS, svgType);\n    }\n\n    if (!this.is3d()) {\n      this.$el.id = `psv-marker-${this.id}`;\n      this.$el[MARKER_DATA] = this;\n    }\n\n    this.update(properties);\n  }\n\n  /**\n   * @summary Destroys the marker\n   */\n  destroy() {\n    delete this.$el[MARKER_DATA];\n    delete this.$el;\n    delete this.config;\n    delete this.props;\n    delete this.psv;\n  }\n\n  /**\n   * @summary Checks if it is a 3D marker (imageLayer)\n   * @returns {boolean}\n   */\n  is3d() {\n    return this.type === MARKER_TYPES.imageLayer;\n  }\n\n  /**\n   * @summary Checks if it is a normal marker (image or html)\n   * @returns {boolean}\n   */\n  isNormal() {\n    return this.type === MARKER_TYPES.image\n      || this.type === MARKER_TYPES.html;\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline marker\n   * @returns {boolean}\n   */\n  isPoly() {\n    return this.isPolygon()\n      || this.isPolyline();\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline using pixel coordinates\n   * @returns {boolean}\n   */\n  isPolyPx() {\n    return this.type === MARKER_TYPES.polygonPx\n      || this.type === MARKER_TYPES.polylinePx;\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline using radian coordinates\n   * @returns {boolean}\n   */\n  isPolyRad() {\n    return this.type === MARKER_TYPES.polygonRad\n      || this.type === MARKER_TYPES.polylineRad;\n  }\n\n  /**\n   * @summary Checks if it is a polygon marker\n   * @returns {boolean}\n   */\n  isPolygon() {\n    return this.type === MARKER_TYPES.polygonPx\n      || this.type === MARKER_TYPES.polygonRad;\n  }\n\n  /**\n   * @summary Checks if it is a polyline marker\n   * @returns {boolean}\n   */\n  isPolyline() {\n    return this.type === MARKER_TYPES.polylinePx\n      || this.type === MARKER_TYPES.polylineRad;\n  }\n\n  /**\n   * @summary Checks if it is an SVG marker\n   * @returns {boolean}\n   */\n  isSvg() {\n    return this.type === MARKER_TYPES.square\n      || this.type === MARKER_TYPES.rect\n      || this.type === MARKER_TYPES.circle\n      || this.type === MARKER_TYPES.ellipse\n      || this.type === MARKER_TYPES.path;\n  }\n\n  /**\n   * @summary Computes marker scale from zoom level\n   * @param {number} zoomLevel\n   * @param {PSV.Position} position\n   * @returns {number}\n   */\n  getScale(zoomLevel, position) {\n    if (!this.config.scale) {\n      return 1;\n    }\n    if (typeof this.config.scale === 'function') {\n      return this.config.scale(zoomLevel, position);\n    }\n\n    let scale = 1;\n    if (Array.isArray(this.config.scale.zoom)) {\n      const bounds = this.config.scale.zoom;\n      scale *= bounds[0] + (bounds[1] - bounds[0]) * CONSTANTS.EASINGS.inQuad(zoomLevel / 100);\n    }\n    if (Array.isArray(this.config.scale.longitude)) {\n      const bounds = this.config.scale.longitude;\n      const halfFov = MathUtils.degToRad(this.psv.prop.hFov) / 2;\n      const arc = Math.abs(utils.getShortestArc(this.props.position.longitude, position.longitude));\n      scale *= bounds[1] + (bounds[0] - bounds[1]) * CONSTANTS.EASINGS.outQuad(Math.max(0, (halfFov - arc) / halfFov));\n    }\n    return scale;\n  }\n\n  /**\n   * @summary Returns the markers list content for the marker, it can be either :\n   * - the `listContent`\n   * - the `tooltip.content`\n   * - the `html`\n   * - the `id`\n   * @returns {*}\n   */\n  getListContent() {\n    if (this.config.listContent) {\n      return this.config.listContent;\n    }\n    else if (this.config.tooltip.content) {\n      return this.config.tooltip.content;\n    }\n    else if (this.config.html) {\n      return this.config.html;\n    }\n    else {\n      return this.id;\n    }\n  }\n\n  /**\n   * @summary Display the tooltip of this marker\n   * @param {{clientX: number, clientY: number}} [mousePosition]\n   */\n  showTooltip(mousePosition) {\n    if (this.props.visible && this.config.tooltip.content && this.props.position2D) {\n      const config = {\n        ...this.config.tooltip,\n        data: this,\n      };\n\n      if (this.isPoly()) {\n        config.box = { // separate the tooltip from the cursor\n          width : this.psv.tooltip.size.arrow * 2,\n          height: this.psv.tooltip.size.arrow * 2,\n        };\n\n        if (mousePosition) {\n          const viewerPos = utils.getPosition(this.psv.container);\n          config.top = mousePosition.clientY - viewerPos.top - this.psv.tooltip.size.arrow / 2;\n          config.left = mousePosition.clientX - viewerPos.left - this.psv.tooltip.size.arrow;\n        }\n        else {\n          config.top = this.props.position2D.y;\n          config.left = this.props.position2D.x;\n        }\n      }\n      else {\n        config.top = this.props.position2D.y;\n        config.left = this.props.position2D.x;\n        config.box = {\n          width : this.props.width,\n          height: this.props.height,\n        };\n      }\n\n      if (this.tooltip) {\n        this.tooltip.move(config);\n      }\n      else {\n        this.tooltip = this.psv.tooltip.create(config);\n      }\n    }\n  }\n\n  /**\n   * @summary Recompute the position of the tooltip\n   */\n  refreshTooltip() {\n    if (this.tooltip) {\n      this.showTooltip();\n    }\n  }\n\n  /**\n   * @summary Hides the tooltip of this marker\n   */\n  hideTooltip() {\n    if (this.tooltip) {\n      this.tooltip.hide();\n      this.tooltip = null;\n    }\n  }\n\n  /**\n   * @summary Updates the marker with new properties\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  update(properties) {\n    const newType = Marker.getType(properties, true);\n\n    if (newType !== undefined && newType !== this.type) {\n      throw new PSVError('cannot change marker type');\n    }\n\n    utils.deepmerge(this.config, properties);\n    if (typeof this.config.tooltip === 'string') {\n      this.config.tooltip = { content: this.config.tooltip };\n    }\n    if (!this.config.tooltip) {\n      this.config.tooltip = {};\n    }\n    if (!this.config.tooltip.trigger) {\n      this.config.tooltip.trigger = MARKER_TOOLTIP_TRIGGER.hover;\n    }\n\n    this.data = this.config.data;\n    this.visible = this.config.visible !== false;\n\n    if (!this.is3d()) {\n      // reset CSS class\n      if (this.isNormal()) {\n        this.$el.className = 'psv-marker psv-marker--normal';\n      }\n      else {\n        this.$el.setAttribute('class', 'psv-marker psv-marker--svg');\n      }\n\n      // add CSS classes\n      if (this.config.className) {\n        utils.addClasses(this.$el, this.config.className);\n      }\n\n      if (this.config.tooltip) {\n        this.$el.classList.add('psv-marker--has-tooltip');\n      }\n      if (this.config.content) {\n        this.$el.classList.add('psv-marler--has-content');\n      }\n\n      // apply style\n      this.$el.style.opacity = this.config.opacity ?? 1;\n      if (this.config.style) {\n        utils.deepmerge(this.$el.style, this.config.style);\n      }\n    }\n\n    // parse anchor\n    this.props.anchor = utils.parsePosition(this.config.anchor);\n\n    // clean scale\n    if (this.config.scale) {\n      if (typeof this.config.scale === 'number') {\n        utils.logWarn('Single value marker scale is deprecated, please use an array of two values.');\n        this.config.scale = { zoom: [0, this.config.scale] };\n      }\n      if (Array.isArray(this.config.scale)) {\n        this.config.scale = { zoom: this.config.scale };\n      }\n    }\n\n    if (this.isNormal()) {\n      this.__updateNormal();\n    }\n    else if (this.isPoly()) {\n      this.__updatePoly();\n    }\n    else if (this.isSvg()) {\n      this.__updateSvg();\n    }\n    else if (this.is3d()) {\n      this.__update3d();\n    }\n  }\n\n  /**\n   * @summary Updates a normal marker\n   * @private\n   */\n  __updateNormal() {\n    if (!utils.isExtendedPosition(this.config)) {\n      throw new PSVError('missing marker position, latitude/longitude or x/y');\n    }\n\n    if (this.config.image && (!this.config.width || !this.config.height)) {\n      throw new PSVError('missing marker width/height');\n    }\n\n    if (this.config.width && this.config.height) {\n      this.props.dynamicSize = false;\n      this.props.width = this.config.width;\n      this.props.height = this.config.height;\n      this.$el.style.width = this.config.width + 'px';\n      this.$el.style.height = this.config.height + 'px';\n    }\n    else {\n      this.props.dynamicSize = true;\n    }\n\n    if (this.config.image) {\n      this.props.def = this.config.image;\n      this.$el.style.backgroundImage = `url(${this.config.image})`;\n    }\n    else if (this.config.html) {\n      this.props.def = this.config.html;\n      this.$el.innerHTML = this.config.html;\n    }\n\n    // set anchor\n    this.$el.style.transformOrigin = `${this.props.anchor.x * 100}% ${this.props.anchor.y * 100}%`;\n\n    // convert texture coordinates to spherical coordinates\n    this.props.position = this.psv.dataHelper.cleanPosition(this.config);\n\n    // compute x/y/z position\n    this.props.positions3D = [this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)];\n  }\n\n  /**\n   * @summary Updates an SVG marker\n   * @private\n   */\n  __updateSvg() {\n    if (!utils.isExtendedPosition(this.config)) {\n      throw new PSVError('missing marker position, latitude/longitude or x/y');\n    }\n\n    this.props.dynamicSize = true;\n\n    // set content\n    switch (this.type) {\n      case MARKER_TYPES.square:\n        this.props.def = {\n          x     : 0,\n          y     : 0,\n          width : this.config.square,\n          height: this.config.square,\n        };\n        break;\n\n      case MARKER_TYPES.rect:\n        if (Array.isArray(this.config.rect)) {\n          this.props.def = {\n            x     : 0,\n            y     : 0,\n            width : this.config.rect[0],\n            height: this.config.rect[1],\n          };\n        }\n        else {\n          this.props.def = {\n            x     : 0,\n            y     : 0,\n            width : this.config.rect.width,\n            height: this.config.rect.height,\n          };\n        }\n        break;\n\n      case MARKER_TYPES.circle:\n        this.props.def = {\n          cx: this.config.circle,\n          cy: this.config.circle,\n          r : this.config.circle,\n        };\n        break;\n\n      case MARKER_TYPES.ellipse:\n        if (Array.isArray(this.config.ellipse)) {\n          this.props.def = {\n            cx: this.config.ellipse[0],\n            cy: this.config.ellipse[1],\n            rx: this.config.ellipse[0],\n            ry: this.config.ellipse[1],\n          };\n        }\n        else {\n          this.props.def = {\n            cx: this.config.ellipse.rx,\n            cy: this.config.ellipse.ry,\n            rx: this.config.ellipse.rx,\n            ry: this.config.ellipse.ry,\n          };\n        }\n        break;\n\n      case MARKER_TYPES.path:\n        this.props.def = {\n          d: this.config.path,\n        };\n        break;\n\n      // no default\n    }\n\n    utils.each(this.props.def, (value, prop) => {\n      this.$el.setAttributeNS(null, prop, value);\n    });\n\n    // set style\n    if (this.config.svgStyle) {\n      utils.each(this.config.svgStyle, (value, prop) => {\n        this.$el.setAttributeNS(null, utils.dasherize(prop), value);\n      });\n    }\n    else {\n      this.$el.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n    }\n\n    // convert texture coordinates to spherical coordinates\n    this.props.position = this.psv.dataHelper.cleanPosition(this.config);\n\n    // compute x/y/z position\n    this.props.positions3D = [this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)];\n  }\n\n  /**\n   * @summary Updates a polygon marker\n   * @private\n   */\n  __updatePoly() {\n    this.props.dynamicSize = true;\n\n    // set style\n    if (this.config.svgStyle) {\n      utils.each(this.config.svgStyle, (value, prop) => {\n        this.$el.setAttributeNS(null, utils.dasherize(prop), value);\n      });\n\n      if (this.isPolyline() && !this.config.svgStyle.fill) {\n        this.$el.setAttributeNS(null, 'fill', 'none');\n      }\n    }\n    else if (this.isPolygon()) {\n      this.$el.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n    }\n    else if (this.isPolyline()) {\n      this.$el.setAttributeNS(null, 'fill', 'none');\n      this.$el.setAttributeNS(null, 'stroke', 'rgb(0,0,0)');\n    }\n\n    // fold arrays: [1,2,3,4] => [[1,2],[3,4]]\n    const actualPoly = this.config.polygonPx || this.config.polygonRad || this.config.polylinePx || this.config.polylineRad;\n    if (!Array.isArray(actualPoly[0])) {\n      for (let i = 0; i < actualPoly.length; i++) {\n        actualPoly.splice(i, 2, [actualPoly[i], actualPoly[i + 1]]);\n      }\n    }\n\n    // convert texture coordinates to spherical coordinates\n    if (this.isPolyPx()) {\n      this.props.def = actualPoly.map((coord) => {\n        const sphericalCoords = this.psv.dataHelper.textureCoordsToSphericalCoords({ x: coord[0], y: coord[1] });\n        return [sphericalCoords.longitude, sphericalCoords.latitude];\n      });\n    }\n    // clean angles\n    else {\n      this.props.def = actualPoly.map((coord) => {\n        return [utils.parseAngle(coord[0]), utils.parseAngle(coord[1], true)];\n      });\n    }\n\n    const centroid = this.isPolygon()\n      ? getPolygonCenter(this.props.def)\n      : getPolylineCenter(this.props.def);\n\n    this.props.position = {\n      longitude: centroid[0],\n      latitude : centroid[1],\n    };\n\n    // compute x/y/z positions\n    this.props.positions3D = this.props.def.map((coord) => {\n      return this.psv.dataHelper.sphericalCoordsToVector3({ longitude: coord[0], latitude: coord[1] });\n    });\n  }\n\n  /**\n   * @summary Updates a 3D marker\n   * @private\n   */\n  __update3d() {\n    if (!this.config.width || !this.config.height) {\n      throw new PSVError('missing marker width/height');\n    }\n\n    this.props.dynamicSize = false;\n    this.props.width = this.config.width;\n    this.props.height = this.config.height;\n\n    // convert texture coordinates to spherical coordinates\n    this.props.position = this.psv.dataHelper.cleanPosition(this.config);\n\n    // compute x/y/z position\n    this.props.positions3D = [this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)];\n\n    switch (this.type) {\n      case MARKER_TYPES.imageLayer:\n        if (!this.$el) {\n          const material = new MeshBasicMaterial({\n            transparent: true,\n            opacity    : this.config.opacity ?? 1,\n            depthTest  : false,\n          });\n          const geometry = new PlaneGeometry(1, 1);\n          const mesh = new Mesh(geometry, material);\n          mesh.userData = { [MARKER_DATA]: this };\n          this.$el = new Group().add(mesh);\n\n          // overwrite the visible property to be tied to the Marker instance\n          // and do it without context bleed\n          Object.defineProperty(this.$el, 'visible', {\n            enumerable: true,\n            get       : function () {\n              return this.children[0].userData[MARKER_DATA].visible;\n            },\n            set       : function (visible) {\n              this.children[0].userData[MARKER_DATA].visible = visible;\n            },\n          });\n        }\n\n        if (this.props.def !== this.config.imageLayer) {\n          if (this.psv.config.requestHeaders && typeof this.psv.config.requestHeaders === 'function') {\n            this.loader.setRequestHeader(this.psv.config.requestHeaders(this.config.imageLayer));\n          }\n          this.$el.children[0].material.map = this.loader.load(this.config.imageLayer, (texture) => {\n            texture.anisotropy = 4;\n            this.psv.needsUpdate();\n          });\n          this.props.def = this.config.imageLayer;\n        }\n\n        this.$el.children[0].position.set(\n          this.props.anchor.x - 0.5,\n          this.props.anchor.y - 0.5,\n          0\n        );\n\n        this.$el.position.copy(this.props.positions3D[0]);\n\n        switch (this.config.orientation) {\n          case 'horizontal':\n            this.$el.lookAt(0, this.$el.position.y, 0);\n            this.$el.rotateX(this.props.position.latitude < 0 ? -Math.PI / 2 : Math.PI / 2);\n            break;\n          case 'vertical-left':\n            this.$el.lookAt(0, 0, 0);\n            this.$el.rotateY(-Math.PI * 0.4);\n            break;\n          case 'vertical-right':\n            this.$el.lookAt(0, 0, 0);\n            this.$el.rotateY(Math.PI * 0.4);\n            break;\n          default:\n            this.$el.lookAt(0, 0, 0);\n            break;\n        }\n\n        // 100 is magic number that gives a coherent size at default zoom level\n        this.$el.scale.set(this.config.width / 100, this.config.height / 100, 1);\n        break;\n\n      // no default\n    }\n  }\n\n  /**\n   * @summary Determines the type of a marker by the available properties\n   * @param {Marker.Properties} properties\n   * @param {boolean} [allowNone=false]\n   * @returns {string}\n   * @throws {PSV.PSVError} when the marker's type cannot be found\n   */\n  static getType(properties, allowNone = false) {\n    const found = [];\n\n    utils.each(MARKER_TYPES, (type) => {\n      if (properties[type]) {\n        found.push(type);\n      }\n    });\n\n    if (found.length === 0 && !allowNone) {\n      throw new PSVError(`missing marker content, either ${Object.keys(MARKER_TYPES).join(', ')}`);\n    }\n    else if (found.length > 1) {\n      throw new PSVError(`multiple marker content, either ${Object.keys(MARKER_TYPES).join(', ')}`);\n    }\n\n    return found[0];\n  }\n\n}\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport pin from './pin.svg';\n\n/**\n * @summary Navigation bar markers button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class MarkersButton extends AbstractButton {\n\n  static id = 'markers';\n  static icon = pin;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-markers-button', true);\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     */\n    this.plugin = this.psv.getPlugin('markers');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.SHOW_MARKERS, this);\n      this.plugin.on(EVENTS.HIDE_MARKERS, this);\n\n      this.toggleActive(true);\n    }\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.SHOW_MARKERS, this);\n      this.plugin.off(EVENTS.HIDE_MARKERS, this);\n    }\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case EVENTS.SHOW_MARKERS: this.toggleActive(true); break;\n      case EVENTS.HIDE_MARKERS: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles markers\n   */\n  onClick() {\n    if (this.plugin.prop.visible) {\n      this.plugin.hide();\n    }\n    else {\n      this.plugin.show();\n    }\n  }\n\n}\n","import { AbstractButton, CONSTANTS } from '../..';\nimport { ID_PANEL_MARKERS_LIST } from './constants';\nimport pinList from './pin-list.svg';\n\n/**\n * @summary Navigation bar markers list button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class MarkersListButton extends AbstractButton {\n\n  static id = 'markersList';\n  static icon = pinList;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-markers-list-button', true);\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     */\n    this.plugin = this.psv.getPlugin('markers');\n\n    if (this.plugin) {\n      this.psv.on(CONSTANTS.EVENTS.OPEN_PANEL, this);\n      this.psv.on(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n    }\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.OPEN_PANEL, this);\n    this.psv.off(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case CONSTANTS.EVENTS.OPEN_PANEL:  this.toggleActive(e.args[0] === ID_PANEL_MARKERS_LIST); break;\n      case CONSTANTS.EVENTS.CLOSE_PANEL: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles markers list\n   */\n  onClick() {\n    this.plugin.toggleMarkersList();\n  }\n\n}\n","import { Vector3 } from 'three';\nimport { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport {\n  EVENTS,\n  ID_PANEL_MARKER,\n  ID_PANEL_MARKERS_LIST,\n  MARKER_DATA,\n  MARKER_TOOLTIP_TRIGGER,\n  MARKERS_LIST_TEMPLATE,\n  SVG_NS\n} from './constants';\nimport { Marker } from './Marker';\nimport { MarkersButton } from './MarkersButton';\nimport { MarkersListButton } from './MarkersListButton';\nimport './style.scss';\n\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.Options\n * @property {boolean} [clickEventOnMarker=false] If a `click` event is triggered on the viewer additionally to the `select-marker` event.\n * @property {PSV.plugins.MarkersPlugin.Properties[]} [markers]\n */\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.SelectMarkerData\n * @summary Data of the `select-marker` event\n * @property {boolean} dblclick - if the selection originated from a double click, the simple click is always fired before the double click\n * @property {boolean} rightclick - if the selection originated from a right click\n */\n\n\n// add markers buttons\nDEFAULTS.lang[MarkersButton.id] = 'Markers';\nDEFAULTS.lang[MarkersListButton.id] = 'Markers list';\nregisterButton(MarkersButton, 'caption:left');\nregisterButton(MarkersListButton, 'caption:left');\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Displays various markers on the viewer\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class MarkersPlugin extends AbstractPlugin {\n\n  static id = 'markers';\n\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.MarkersPlugin.Options} [options]\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @summary All registered markers\n     * @member {Object<string, PSV.plugins.MarkersPlugin.Marker>}\n     */\n    this.markers = {};\n\n    /**\n     * @type {Object}\n     * @property {boolean} visible - Visibility of the component\n     * @property {PSV.plugins.MarkersPlugin.Marker} currentMarker - Last selected marker\n     * @property {PSV.plugins.MarkersPlugin.Marker} hoveringMarker - Marker under the cursor\n     * @private\n     */\n    this.prop = {\n      visible       : true,\n      currentMarker : null,\n      hoveringMarker: null,\n      stopObserver  : null,\n    };\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin.Options}\n     */\n    this.config = {\n      clickEventOnMarker: false,\n      ...options,\n    };\n\n    if (options?.listButton === false || options?.hideButton === false) {\n      utils.logWarn('MarkersPlugin: listButton and hideButton options are deprecated. '\n        + 'Please define the global navbar options according to your needs.');\n    }\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     */\n    this.container = document.createElement('div');\n    this.container.className = 'psv-markers';\n    this.container.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n\n    /**\n     * @member {SVGElement}\n     * @readonly\n     */\n    this.svgContainer = document.createElementNS(SVG_NS, 'svg');\n    this.svgContainer.setAttribute('class', 'psv-markers-svg-container');\n    this.container.appendChild(this.svgContainer);\n\n    // Markers events via delegation\n    this.container.addEventListener('mouseenter', this, true);\n    this.container.addEventListener('mouseleave', this, true);\n    this.container.addEventListener('mousemove', this, true);\n    this.container.addEventListener('contextmenu', this);\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.psv.container.appendChild(this.container);\n\n    // Viewer events\n    this.psv.on(CONSTANTS.EVENTS.CLICK, this);\n    this.psv.on(CONSTANTS.EVENTS.DOUBLE_CLICK, this);\n    this.psv.on(CONSTANTS.EVENTS.RENDER, this);\n    this.psv.on(CONSTANTS.EVENTS.CONFIG_CHANGED, this);\n\n    this.psv.once(CONSTANTS.EVENTS.READY, () => {\n      if (this.config.markers) {\n        this.setMarkers(this.config.markers);\n        delete this.config.markers;\n      }\n    });\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.clearMarkers(false);\n\n    this.prop.stopObserver?.();\n\n    this.psv.off(CONSTANTS.EVENTS.CLICK, this);\n    this.psv.off(CONSTANTS.EVENTS.DOUBLE_CLICK, this);\n    this.psv.off(CONSTANTS.EVENTS.RENDER, this);\n    this.psv.off(CONSTANTS.EVENTS.CONFIG_CHANGED, this);\n\n    this.psv.container.removeChild(this.container);\n\n    delete this.svgContainer;\n    delete this.markers;\n    delete this.container;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mouseenter':  this.__onMouseEnter(e, this.__getTargetMarker(e.target)); break;\n      case 'mouseleave':  this.__onMouseLeave(e, this.__getTargetMarker(e.target)); break;\n      case 'mousemove':   this.__onMouseMove(e, this.__getTargetMarker(e.target));  break;\n      case 'contextmenu': e.preventDefault(); break;\n      case CONSTANTS.EVENTS.CLICK:        this.__onClick(e, e.args[0], false); break;\n      case CONSTANTS.EVENTS.DOUBLE_CLICK: this.__onClick(e, e.args[0], true);  break;\n      case CONSTANTS.EVENTS.RENDER:       this.renderMarkers();                        break;\n      case CONSTANTS.OBJECT_EVENTS.ENTER_OBJECT: this.__onMouseEnter(e.detail.originalEvent, e.detail.data); break;\n      case CONSTANTS.OBJECT_EVENTS.LEAVE_OBJECT: this.__onMouseLeave(e.detail.originalEvent, e.detail.data); break;\n      case CONSTANTS.OBJECT_EVENTS.HOVER_OBJECT: this.__onMouseMove(e.detail.originalEvent, e.detail.data);  break;\n      case CONSTANTS.EVENTS.CONFIG_CHANGED:\n        this.container.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n        break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @summary Shows all markers\n   * @fires PSV.plugins.MarkersPlugin.show-markers\n   */\n  show() {\n    this.prop.visible = true;\n\n    this.renderMarkers();\n\n    this.trigger(EVENTS.SHOW_MARKERS);\n  }\n\n  /**\n   * @summary Hides all markers\n   * @fires PSV.plugins.MarkersPlugin.hide-markers\n   */\n  hide() {\n    this.prop.visible = false;\n\n    this.renderMarkers();\n\n    this.trigger(EVENTS.HIDE_MARKERS);\n  }\n\n  /**\n   * @summary Toggles the visibility of all tooltips\n   */\n  toggleAllTooltips() {\n    if (this.prop.showAllTooltips) {\n      this.hideAllTooltips();\n    }\n    else {\n      this.showAllTooltips();\n    }\n  }\n\n  /**\n   * @summary Displays all tooltips\n   */\n  showAllTooltips() {\n    this.prop.showAllTooltips = true;\n    utils.each(this.markers, (marker) => {\n      marker.props.staticTooltip = true;\n      marker.showTooltip();\n    });\n  }\n\n  /**\n   * @summary Hides all tooltips\n   */\n  hideAllTooltips() {\n    this.prop.showAllTooltips = false;\n    utils.each(this.markers, (marker) => {\n      marker.props.staticTooltip = false;\n      marker.hideTooltip();\n    });\n  }\n\n  /**\n   * @summary Returns the total number of markers\n   * @returns {number}\n   */\n  getNbMarkers() {\n    return Object.keys(this.markers).length;\n  }\n\n  /**\n   * @summary Returns all the markers\n   * @return {PSV.plugins.MarkersPlugin.Marker[]}\n   */\n  getMarkers() {\n    return Object.values(this.markers);\n  }\n\n  /**\n   * @summary Adds a new marker to viewer\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {boolean} [render=true] - renders the marker immediately\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @throws {PSV.PSVError} when the marker's id is missing or already exists\n   */\n  addMarker(properties, render = true) {\n    if (this.markers[properties.id]) {\n      throw new PSVError(`marker \"${properties.id}\" already exists`);\n    }\n\n    const marker = new Marker(properties, this.psv);\n\n    if (marker.isNormal()) {\n      this.container.appendChild(marker.$el);\n    }\n    else if (marker.isPoly() || marker.isSvg()) {\n      this.svgContainer.appendChild(marker.$el);\n    }\n    else if (marker.is3d()) {\n      this.psv.renderer.scene.add(marker.$el);\n    }\n\n    this.markers[marker.id] = marker;\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n      this.__checkObjectsObserver();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n\n    return marker;\n  }\n\n  /**\n   * @summary Returns the internal marker object for a marker id\n   * @param {string} markerId\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @throws {PSV.PSVError} when the marker cannot be found\n   */\n  getMarker(markerId) {\n    const id = typeof markerId === 'object' ? markerId.id : markerId;\n\n    if (!this.markers[id]) {\n      throw new PSVError(`cannot find marker \"${id}\"`);\n    }\n\n    return this.markers[id];\n  }\n\n  /**\n   * @summary Returns the last marker selected by the user\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   */\n  getCurrentMarker() {\n    return this.prop.currentMarker;\n  }\n\n  /**\n   * @summary Updates the existing marker with the same id\n   * @description Every property can be changed but you can't change its type (Eg: `image` to `html`).\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {boolean} [render=true] - renders the marker immediately\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   */\n  updateMarker(properties, render = true) {\n    const marker = this.getMarker(properties.id);\n\n    marker.update(properties);\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n\n      if (marker.is3d()) {\n        this.psv.needsUpdate();\n      }\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n\n    return marker;\n  }\n\n  /**\n   * @summary Removes a marker from the viewer\n   * @param {string} markerId\n   * @param {boolean} [render=true] - renders the marker immediately\n   */\n  removeMarker(markerId, render = true) {\n    const marker = this.getMarker(markerId);\n\n    if (marker.isNormal()) {\n      this.container.removeChild(marker.$el);\n    }\n    else if (marker.isPoly() || marker.isSvg()) {\n      this.svgContainer.removeChild(marker.$el);\n    }\n    else if (marker.is3d()) {\n      this.psv.renderer.scene.remove(marker.$el);\n      this.psv.needsUpdate();\n    }\n\n    if (this.prop.hoveringMarker === marker) {\n      this.prop.hoveringMarker = null;\n    }\n\n    if (this.prop.currentMarker === marker) {\n      this.prop.currentMarker = null;\n    }\n\n    marker.hideTooltip();\n\n    marker.destroy();\n    delete this.markers[marker.id];\n\n    if (render) {\n      this.__refreshUi();\n      this.__checkObjectsObserver();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Removes multiple markers\n   * @param {string[]} markerIds\n   * @param {boolean} [render=true] - renders the markers immediately\n   */\n  removeMarkers(markerIds, render = true) {\n    markerIds.forEach(markerId => this.removeMarker(markerId, false));\n\n    if (render) {\n      this.__refreshUi();\n      this.__checkObjectsObserver();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Replaces all markers\n   * @param {PSV.plugins.MarkersPlugin.Properties[]} markers\n   * @param {boolean} [render=true] - renders the marker immediately\n   */\n  setMarkers(markers, render = true) {\n    this.clearMarkers(false);\n\n    utils.each(markers, marker => this.addMarker(marker, false));\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n      this.__checkObjectsObserver();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Removes all markers\n   * @param {boolean} [render=true] - renders the markers immediately\n   */\n  clearMarkers(render = true) {\n    utils.each(this.markers, marker => this.removeMarker(marker, false));\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n      this.__checkObjectsObserver();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Rotate the view to face the marker\n   * @param {string} markerId\n   * @param {string|number} [speed] - rotates smoothy, see {@link PSV.Viewer#animate}\n   * @fires PSV.plugins.MarkersPlugin.goto-marker-done\n   * @return {PSV.Animation}  A promise that will be resolved when the animation finishes\n   */\n  gotoMarker(markerId, speed) {\n    const marker = this.getMarker(markerId);\n\n    return this.psv.animate({\n      ...marker.props.position,\n      speed,\n    })\n      .then(() => {\n        this.trigger(EVENTS.GOTO_MARKER_DONE, marker);\n      });\n  }\n\n  /**\n   * @summary Hides a marker\n   * @param {string} markerId\n   */\n  hideMarker(markerId) {\n    this.toggleMarker(markerId, false);\n  }\n\n  /**\n   * @summary Shows a marker\n   * @param {string} markerId\n   */\n  showMarker(markerId) {\n    this.toggleMarker(markerId, true);\n  }\n\n  /**\n   * @summary Forces the display of the tooltip\n   * @param {string} markerId\n   */\n  showMarkerTooltip(markerId) {\n    const marker = this.getMarker(markerId);\n    marker.props.staticTooltip = true;\n    marker.showTooltip();\n  }\n\n  /**\n   * @summary Hides the tooltip\n   * @param {string} markerId\n   */\n  hideMarkerTooltip(markerId) {\n    const marker = this.getMarker(markerId);\n    marker.props.staticTooltip = false;\n    marker.hideTooltip();\n  }\n\n  /**\n   * @summary Toggles a marker\n   * @param {string} markerId\n   * @param {boolean} [visible]\n   */\n  toggleMarker(markerId, visible = null) {\n    const marker = this.getMarker(markerId);\n    marker.visible = visible === null ? !marker.visible : visible;\n    if (marker.is3d()) {\n      this.psv.needsUpdate();\n    }\n    else {\n      this.renderMarkers();\n    }\n  }\n\n  /**\n   * @summary Opens the panel with the content of the marker\n   * @param {string} markerId\n   */\n  showMarkerPanel(markerId) {\n    const marker = this.getMarker(markerId);\n\n    if (marker?.config?.content) {\n      this.psv.panel.show({\n        id     : ID_PANEL_MARKER,\n        content: marker.config.content,\n      });\n    }\n    else {\n      this.psv.panel.hide(ID_PANEL_MARKER);\n    }\n  }\n\n  /**\n   * @summary Toggles the visibility of the list of markers\n   */\n  toggleMarkersList() {\n    if (this.psv.panel.prop.contentId === ID_PANEL_MARKERS_LIST) {\n      this.hideMarkersList();\n    }\n    else {\n      this.showMarkersList();\n    }\n  }\n\n  /**\n   * @summary Opens side panel with the list of markers\n   * @fires PSV.plugins.MarkersPlugin.filter:render-markers-list\n   */\n  showMarkersList() {\n    let markers = [];\n    utils.each(this.markers, (marker) => {\n      if (marker.visible && !marker.config.hideList) {\n        markers.push(marker);\n      }\n    });\n\n    markers = this.change(EVENTS.RENDER_MARKERS_LIST, markers);\n\n    this.psv.panel.show({\n      id          : ID_PANEL_MARKERS_LIST,\n      content     : MARKERS_LIST_TEMPLATE(markers, this.psv.config.lang[MarkersButton.id]),\n      noMargin    : true,\n      clickHandler: (e) => {\n        const li = e.target ? utils.getClosest(e.target, 'li') : undefined;\n        const markerId = li ? li.dataset[MARKER_DATA] : undefined;\n\n        if (markerId) {\n          const marker = this.getMarker(markerId);\n\n          this.trigger(EVENTS.SELECT_MARKER_LIST, marker);\n\n          this.gotoMarker(marker, 1000);\n          this.hideMarkersList();\n        }\n      },\n    });\n  }\n\n  /**\n   * @summary Closes side panel if it contains the list of markers\n   */\n  hideMarkersList() {\n    this.psv.panel.hide(ID_PANEL_MARKERS_LIST);\n  }\n\n  /**\n   * @summary Updates the visibility and the position of all markers\n   */\n  renderMarkers() {\n    const zoomLevel = this.psv.getZoomLevel();\n    const viewerPosition = this.psv.getPosition();\n\n    utils.each(this.markers, (marker) => {\n      let isVisible = this.prop.visible && marker.visible;\n      let visibilityChanged = false;\n      let position = null;\n\n      if (isVisible && marker.is3d()) {\n        position = this.__getMarkerPosition(marker);\n        isVisible = this.__isMarkerVisible(marker, position);\n      }\n      else if (isVisible && marker.isPoly()) {\n        const positions = this.__getPolyPositions(marker);\n        isVisible = positions.length > (marker.isPolygon() ? 2 : 1);\n\n        if (isVisible) {\n          position = this.__getMarkerPosition(marker);\n\n          const points = positions.map(pos => (pos.x - position.x) + ',' + (pos.y - position.y)).join(' ');\n\n          marker.$el.setAttributeNS(null, 'points', points);\n          marker.$el.setAttributeNS(null, 'transform', `translate(${position.x} ${position.y})`);\n        }\n      }\n      else if (isVisible) {\n        if (marker.props.dynamicSize) {\n          this.__updateMarkerSize(marker);\n        }\n\n        position = this.__getMarkerPosition(marker);\n        isVisible = this.__isMarkerVisible(marker, position);\n\n        if (isVisible) {\n          const scale = marker.getScale(zoomLevel, viewerPosition);\n\n          if (marker.isSvg()) {\n            // simulate transform-origin relative to SVG element\n            const x = position.x + marker.props.width * marker.props.anchor.x * (1 - scale);\n            const y = position.y + marker.props.height * marker.props.anchor.y * (1 - scale);\n            marker.$el.setAttributeNS(null, 'transform', `translate(${x}, ${y}) scale(${scale}, ${scale})`);\n          }\n          else {\n            marker.$el.style.transform = `translate3D(${position.x}px, ${position.y}px, 0px) scale(${scale}, ${scale})`;\n          }\n        }\n      }\n\n      visibilityChanged = marker.props.visible !== isVisible;\n      marker.props.visible = isVisible;\n      marker.props.position2D = isVisible ? position : null;\n\n      if (!marker.is3d()) {\n        utils.toggleClass(marker.$el, 'psv-marker--visible', isVisible);\n      }\n\n      if (!isVisible) {\n        marker.hideTooltip();\n      }\n      else if (marker.props.staticTooltip) {\n        marker.showTooltip();\n      }\n      else if (marker.config.tooltip.trigger === MARKER_TOOLTIP_TRIGGER.click || (marker === this.prop.hoveringMarker && !marker.isPoly())) {\n        marker.refreshTooltip();\n      }\n      else if (marker !== this.prop.hoveringMarker) {\n        marker.hideTooltip();\n      }\n\n      if (visibilityChanged) {\n        this.trigger(EVENTS.MARKER_VISIBILITY, marker, isVisible);\n      }\n    });\n  }\n\n  /**\n   * @summary Determines if a point marker is visible<br>\n   * It tests if the point is in the general direction of the camera, then check if it's in the viewport\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @param {PSV.Point} position\n   * @returns {boolean}\n   * @private\n   */\n  __isMarkerVisible(marker, position) {\n    return marker.props.positions3D[0].dot(this.psv.prop.direction) > 0\n      && position.x + marker.props.width >= 0\n      && position.x - marker.props.width <= this.psv.prop.size.width\n      && position.y + marker.props.height >= 0\n      && position.y - marker.props.height <= this.psv.prop.size.height;\n  }\n\n  /**\n   * @summary Computes the real size of a marker\n   * @description This is done by removing all it's transformations (if any) and making it visible\n   * before querying its bounding rect\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @private\n   */\n  __updateMarkerSize(marker) {\n    marker.$el.classList.add('psv-marker--transparent');\n\n    let transform;\n    if (marker.isSvg()) {\n      transform = marker.$el.getAttributeNS(null, 'transform');\n      marker.$el.removeAttributeNS(null, 'transform');\n    }\n    else {\n      transform = marker.$el.style.transform;\n      marker.$el.style.transform = '';\n    }\n\n    const rect = marker.$el.getBoundingClientRect();\n    marker.props.width = rect.width;\n    marker.props.height = rect.height;\n\n    marker.$el.classList.remove('psv-marker--transparent');\n\n    if (transform) {\n      if (marker.isSvg()) {\n        marker.$el.setAttributeNS(null, 'transform', transform);\n      }\n      else {\n        marker.$el.style.transform = transform;\n      }\n    }\n\n    // the size is no longer dynamic once known\n    marker.props.dynamicSize = false;\n  }\n\n  /**\n   * @summary Computes viewer coordinates of a marker\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @returns {PSV.Point}\n   * @private\n   */\n  __getMarkerPosition(marker) {\n    if (marker.isPoly()) {\n      return this.psv.dataHelper.sphericalCoordsToViewerCoords(marker.props.position);\n    }\n    else {\n      const position = this.psv.dataHelper.vector3ToViewerCoords(marker.props.positions3D[0]);\n\n      position.x -= marker.props.width * marker.props.anchor.x;\n      position.y -= marker.props.height * marker.props.anchor.y;\n\n      return position;\n    }\n  }\n\n  /**\n   * @summary Computes viewer coordinates of each point of a polygon/polyline<br>\n   * It handles points behind the camera by creating intermediary points suitable for the projector\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @returns {PSV.Point[]}\n   * @private\n   */\n  __getPolyPositions(marker) {\n    const nbVectors = marker.props.positions3D.length;\n\n    // compute if each vector is visible\n    const positions3D = marker.props.positions3D.map((vector) => {\n      return {\n        vector : vector,\n        visible: vector.dot(this.psv.prop.direction) > 0,\n      };\n    });\n\n    // get pairs of visible/invisible vectors for each invisible vector connected to a visible vector\n    const toBeComputed = [];\n    positions3D.forEach((pos, i) => {\n      if (!pos.visible) {\n        const neighbours = [\n          i === 0 ? positions3D[nbVectors - 1] : positions3D[i - 1],\n          i === nbVectors - 1 ? positions3D[0] : positions3D[i + 1],\n        ];\n\n        neighbours.forEach((neighbour) => {\n          if (neighbour.visible) {\n            toBeComputed.push({\n              visible  : neighbour,\n              invisible: pos,\n              index    : i,\n            });\n          }\n        });\n      }\n    });\n\n    // compute intermediary vector for each pair (the loop is reversed for splice to insert at the right place)\n    toBeComputed.reverse().forEach((pair) => {\n      positions3D.splice(pair.index, 0, {\n        vector : this.__getPolyIntermediaryPoint(pair.visible.vector, pair.invisible.vector),\n        visible: true,\n      });\n    });\n\n    // translate vectors to screen pos\n    return positions3D\n      .filter(pos => pos.visible)\n      .map(pos => this.psv.dataHelper.vector3ToViewerCoords(pos.vector));\n  }\n\n  /**\n   * Given one point in the same direction of the camera and one point behind the camera,\n   * computes an intermediary point on the great circle delimiting the half sphere visible by the camera.\n   * The point is shifted by .01 rad because the projector cannot handle points exactly on this circle.\n   * TODO : does not work with fisheye view (must not use the great circle)\n   * {@link http://math.stackexchange.com/a/1730410/327208}\n   * @param P1 {external:THREE.Vector3}\n   * @param P2 {external:THREE.Vector3}\n   * @returns {external:THREE.Vector3}\n   * @private\n   */\n  __getPolyIntermediaryPoint(P1, P2) {\n    const C = this.psv.prop.direction.clone().normalize();\n    const N = new Vector3().crossVectors(P1, P2).normalize();\n    const V = new Vector3().crossVectors(N, P1).normalize();\n    const X = P1.clone().multiplyScalar(-C.dot(V));\n    const Y = V.clone().multiplyScalar(C.dot(P1));\n    const H = new Vector3().addVectors(X, Y).normalize();\n    const a = new Vector3().crossVectors(H, C);\n    return H.applyAxisAngle(a, 0.01).multiplyScalar(CONSTANTS.SPHERE_RADIUS);\n  }\n\n  /**\n   * @summary Returns the marker associated to an event target\n   * @param {EventTarget} target\n   * @param {boolean} [closest=false]\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @private\n   */\n  __getTargetMarker(target, closest = false) {\n    const target2 = closest ? utils.getClosest(target, '.psv-marker') : target;\n    return target2 ? target2[MARKER_DATA] : undefined;\n  }\n\n  /**\n   * @summary Checks if an event target is in the tooltip\n   * @param {EventTarget} target\n   * @param {PSV.components.Tooltip} tooltip\n   * @returns {boolean}\n   * @private\n   */\n  __targetOnTooltip(target, tooltip) {\n    return target && tooltip ? utils.hasParent(target, tooltip.container) : false;\n  }\n\n  /**\n   * @summary Handles mouse enter events, show the tooltip for non polygon markers\n   * @param {MouseEvent} e\n   * @param {PSV.plugins.MarkersPlugin.Marker} [marker]\n   * @fires PSV.plugins.MarkersPlugin.over-marker\n   * @private\n   */\n  __onMouseEnter(e, marker) {\n    if (marker && !marker.isPoly()) {\n      this.prop.hoveringMarker = marker;\n\n      this.trigger(EVENTS.OVER_MARKER, marker);\n\n      if (!marker.props.staticTooltip && marker.config.tooltip.trigger === MARKER_TOOLTIP_TRIGGER.hover) {\n        marker.showTooltip(e);\n      }\n    }\n  }\n\n  /**\n   * @summary Handles mouse leave events, hide the tooltip\n   * @param {MouseEvent} e\n   * @param {PSV.plugins.MarkersPlugin.Marker} [marker]\n   * @fires PSV.plugins.MarkersPlugin.leave-marker\n   * @private\n   */\n  __onMouseLeave(e, marker) {\n    // do not hide if we enter the tooltip itself while hovering a polygon\n    if (marker && !(marker.isPoly() && this.__targetOnTooltip(e.relatedTarget, marker.tooltip))) {\n      this.trigger(EVENTS.LEAVE_MARKER, marker);\n\n      this.prop.hoveringMarker = null;\n\n      if (!marker.props.staticTooltip && marker.config.tooltip.trigger === MARKER_TOOLTIP_TRIGGER.hover) {\n        marker.hideTooltip();\n      }\n    }\n  }\n\n  /**\n   * @summary Handles mouse move events, refreshUi the tooltip for polygon markers\n   * @param {MouseEvent} e\n   * @param {PSV.plugins.MarkersPlugin.Marker} [targetMarker]\n   * @fires PSV.plugins.MarkersPlugin.leave-marker\n   * @fires PSV.plugins.MarkersPlugin.over-marker\n   * @private\n   */\n  __onMouseMove(e, targetMarker) {\n    let marker;\n\n    if (targetMarker?.isPoly()) {\n      marker = targetMarker;\n    }\n    // do not hide if we enter the tooltip itself while hovering a polygon\n    else if (this.prop.hoveringMarker && this.__targetOnTooltip(e.target, this.prop.hoveringMarker.tooltip)) {\n      marker = this.prop.hoveringMarker;\n    }\n\n    if (marker) {\n      if (!this.prop.hoveringMarker) {\n        this.trigger(EVENTS.OVER_MARKER, marker);\n\n        this.prop.hoveringMarker = marker;\n      }\n\n      if (!marker.props.staticTooltip) {\n        marker.showTooltip(e);\n      }\n    }\n    else if (this.prop.hoveringMarker?.isPoly()) {\n      this.trigger(EVENTS.LEAVE_MARKER, this.prop.hoveringMarker);\n\n      if (!this.prop.hoveringMarker.props.staticTooltip) {\n        this.prop.hoveringMarker.hideTooltip();\n      }\n\n      this.prop.hoveringMarker = null;\n    }\n  }\n\n  /**\n   * @summary Handles mouse click events, select the marker and open the panel if necessary\n   * @param {Event} e\n   * @param {Object} data\n   * @param {boolean} dblclick\n   * @fires PSV.plugins.MarkersPlugin.select-marker\n   * @fires PSV.plugins.MarkersPlugin.unselect-marker\n   * @private\n   */\n  __onClick(e, data, dblclick) {\n    let marker = data.objects.find(o => o.userData[MARKER_DATA])?.userData[MARKER_DATA];\n\n    if (!marker) {\n      marker = this.__getTargetMarker(data.target, true);\n    }\n\n    if (this.prop.currentMarker && this.prop.currentMarker !== marker) {\n      this.trigger(EVENTS.UNSELECT_MARKER, this.prop.currentMarker);\n\n      this.psv.panel.hide(ID_PANEL_MARKER);\n\n      if (!this.prop.showAllTooltips && this.prop.currentMarker.config.tooltip.trigger === MARKER_TOOLTIP_TRIGGER.click) {\n        this.hideMarkerTooltip(this.prop.currentMarker);\n      }\n\n      this.prop.currentMarker = null;\n    }\n\n    if (marker) {\n      this.prop.currentMarker = marker;\n\n      this.trigger(EVENTS.SELECT_MARKER, marker, {\n        dblclick  : dblclick,\n        rightclick: data.rightclick,\n      });\n\n      if (this.config.clickEventOnMarker) {\n        // add the marker to event data\n        data.marker = marker;\n      }\n      else {\n        e.stopPropagation();\n      }\n\n      // the marker could have been deleted in an event handler\n      if (this.markers[marker.id]) {\n        if (marker.config.tooltip.trigger === MARKER_TOOLTIP_TRIGGER.click) {\n          if (marker.tooltip) {\n            this.hideMarkerTooltip(marker);\n          }\n          else {\n            this.showMarkerTooltip(marker);\n          }\n        }\n        else {\n          this.showMarkerPanel(marker.id);\n        }\n      }\n    }\n  }\n\n  /**\n   * @summary Updates the visiblity of the panel and the buttons\n   * @private\n   */\n  __refreshUi() {\n    const nbMarkers = Object.values(this.markers).filter(m => !m.config.hideList).length;\n    const markersButton = this.psv.navbar.getButton(MarkersButton.id, false);\n    const markersListButton = this.psv.navbar.getButton(MarkersListButton.id, false);\n\n    if (nbMarkers === 0) {\n      markersButton?.hide();\n      markersListButton?.hide();\n\n      if (this.psv.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n        this.psv.panel.hide();\n      }\n      else if (this.psv.panel.isVisible(ID_PANEL_MARKER)) {\n        this.psv.panel.hide();\n      }\n    }\n    else {\n      markersButton?.show();\n      markersListButton?.show();\n\n      if (this.psv.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n        this.showMarkersList();\n      }\n      else if (this.psv.panel.isVisible(ID_PANEL_MARKER)) {\n        this.prop.currentMarker ? this.showMarkerPanel(this.prop.currentMarker) : this.psv.panel.hide();\n      }\n    }\n  }\n\n  /**\n   * @summary Adds or remove the objects observer if there are 3D markers\n   * @private\n   */\n  __checkObjectsObserver() {\n    const has3d = Object.values(this.markers).some(marker => marker.is3d());\n\n    if (!has3d && this.prop.stopObserver) {\n      this.prop.stopObserver();\n      this.prop.stopObserver = null;\n    }\n    else if (has3d && !this.prop.stopObserver) {\n      this.prop.stopObserver = this.psv.observeObjects(MARKER_DATA, this);\n    }\n  }\n\n}\n"],"names":["EVENTS","MARKER_VISIBILITY","GOTO_MARKER_DONE","LEAVE_MARKER","OVER_MARKER","RENDER_MARKERS_LIST","SELECT_MARKER","SELECT_MARKER_LIST","UNSELECT_MARKER","HIDE_MARKERS","SET_MARKERS","SHOW_MARKERS","MARKER_TOOLTIP_TRIGGER","click","hover","SVG_NS","MARKER_DATA","ID_PANEL_MARKER","ID_PANEL_MARKERS_LIST","MARKER_DATA_KEY","utils","dasherize","MARKERS_LIST_TEMPLATE","markers","title","icon","map","marker","config","id","type","image","getListContent","join","greatArcIntermediaryPoint","p1","p2","f","λ1","φ1","λ2","φ2","r","greatArcDistance","a","Math","sin","b","x","cos","y","z","atan2","sqrt","getPolygonCenter","polygon","workPoints","k","i","length","d","PI","push","sum","reduce","intermediary","point","parseAngle","getPolylineCenter","polyline","lengths","l","CONSTANTS","SPHERE_RADIUS","consumed","j","round","MARKER_TYPES","imageLayer","html","polygonPx","polygonRad","polylinePx","polylineRad","square","rect","circle","ellipse","path","Marker","properties","psv","PSVError","getType","visible","$el","data","undefined","tooltip","props","dynamicSize","anchor","staticTooltip","position","position2D","positions3D","width","height","def","loader","is3d","TextureLoader","withCredentials","setWithCredentials","requestHeaders","setRequestHeader","isNormal","document","createElement","isPolygon","createElementNS","isPolyline","isSvg","svgType","update","destroy","isPoly","isPolyPx","isPolyRad","getScale","zoomLevel","scale","Array","isArray","zoom","bounds","EASINGS","inQuad","longitude","halfFov","MathUtils","degToRad","prop","hFov","arc","abs","getShortestArc","outQuad","max","listContent","content","showTooltip","mousePosition","box","size","arrow","viewerPos","getPosition","container","top","clientY","left","clientX","move","create","refreshTooltip","hideTooltip","hide","newType","deepmerge","trigger","className","setAttribute","addClasses","classList","add","style","opacity","parsePosition","logWarn","__updateNormal","__updatePoly","__updateSvg","__update3d","isExtendedPosition","backgroundImage","innerHTML","transformOrigin","dataHelper","cleanPosition","sphericalCoordsToVector3","cx","cy","rx","ry","each","value","setAttributeNS","svgStyle","fill","actualPoly","splice","coord","sphericalCoords","textureCoordsToSphericalCoords","latitude","centroid","material","MeshBasicMaterial","transparent","depthTest","geometry","PlaneGeometry","mesh","Mesh","userData","Group","Object","defineProperty","enumerable","get","children","set","load","texture","anisotropy","needsUpdate","copy","orientation","lookAt","rotateX","rotateY","allowNone","found","keys","MarkersButton","navbar","plugin","getPlugin","on","toggleActive","off","isSupported","handleEvent","e","onClick","show","AbstractButton","pin","MarkersListButton","OPEN_PANEL","CLOSE_PANEL","args","toggleMarkersList","pinList","DEFAULTS","lang","registerButton","MarkersPlugin","options","currentMarker","hoveringMarker","stopObserver","clickEventOnMarker","listButton","hideButton","cursor","mousemove","svgContainer","appendChild","addEventListener","init","CLICK","DOUBLE_CLICK","RENDER","CONFIG_CHANGED","once","READY","setMarkers","clearMarkers","removeChild","__onMouseEnter","__getTargetMarker","target","__onMouseLeave","__onMouseMove","preventDefault","__onClick","renderMarkers","OBJECT_EVENTS","ENTER_OBJECT","detail","originalEvent","LEAVE_OBJECT","HOVER_OBJECT","toggleAllTooltips","showAllTooltips","hideAllTooltips","getNbMarkers","getMarkers","values","addMarker","render","renderer","scene","__refreshUi","__checkObjectsObserver","getMarker","markerId","getCurrentMarker","updateMarker","removeMarker","remove","removeMarkers","markerIds","forEach","gotoMarker","speed","animate","then","hideMarker","toggleMarker","showMarker","showMarkerTooltip","hideMarkerTooltip","showMarkerPanel","panel","contentId","hideMarkersList","showMarkersList","hideList","change","noMargin","clickHandler","li","getClosest","dataset","getZoomLevel","viewerPosition","isVisible","visibilityChanged","__getMarkerPosition","__isMarkerVisible","positions","__getPolyPositions","points","pos","__updateMarkerSize","transform","toggleClass","dot","direction","getAttributeNS","removeAttributeNS","getBoundingClientRect","sphericalCoordsToViewerCoords","vector3ToViewerCoords","nbVectors","vector","toBeComputed","neighbours","neighbour","invisible","index","reverse","pair","__getPolyIntermediaryPoint","filter","P1","P2","C","clone","normalize","N","Vector3","crossVectors","V","X","multiplyScalar","Y","H","addVectors","applyAxisAngle","closest","target2","__targetOnTooltip","hasParent","relatedTarget","targetMarker","dblclick","objects","find","o","rightclick","stopPropagation","nbMarkers","m","markersButton","getButton","markersListButton","has3d","some","observeObjects","AbstractPlugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAGA;EACA;EACA;EACA;EACA;EACA;;MACaA,MAAM,GAAG;EACpB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,iBAAiB,EAAI,mBARD;;EASpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,gBAAgB,EAAK,kBAfD;;EAgBpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,YAAY,EAAS,cAtBD;;EAuBpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,WAAW,EAAU,aA7BD;;EA8BpB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,mBAAmB,EAAE,qBArCD;;EAsCpB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,aAAa,EAAQ,eA9CD;;EA+CpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,kBAAkB,EAAG,oBArDD;;EAsDpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,eAAe,EAAM,iBA5DD;;EA6DpB;EACF;EACA;EACA;EACA;EACEC,EAAAA,YAAY,EAAS,cAlED;;EAmEpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,WAAW,EAAU,aAzED;;EA0EpB;EACF;EACA;EACA;EACA;EACEC,EAAAA,YAAY,EAAS;EA/ED;EAkFtB;EACA;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,sBAAsB,GAAG;EACpCC,EAAAA,KAAK,EAAE,OAD6B;EAEpCC,EAAAA,KAAK,EAAE;EAF6B,CAA/B;EAKP;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,MAAM,GAAG,4BAAf;EAEP;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,WAAW,GAAG,WAApB;EAEP;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,eAAe,GAAG,QAAxB;EAEP;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,qBAAqB,GAAG,aAA9B;EAEP,IAAMC,eAAe,GAAGC,uBAAK,CAACC,SAAN,CAAgBL,WAA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"}