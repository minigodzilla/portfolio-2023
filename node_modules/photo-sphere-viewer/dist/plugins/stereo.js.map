{"version":3,"file":"stereo.js","sources":["../../src/plugins/stereo/constants.js","../../src/plugins/stereo/StereoButton.js","../../src/plugins/stereo/StereoEffect.js","../../src/plugins/stereo/index.js"],"sourcesContent":["/**\n * @summary Available events\n * @enum {string}\n * @memberof PSV.plugins.StereoPlugin\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event stereo-updated\n   * @memberof PSV.plugins.StereoPlugin\n   * @summary Triggered when the stereo view is enabled/disabled\n   * @param {boolean} enabled\n   */\n  STEREO_UPDATED: 'stereo-updated',\n};\n\n/**\n * @type {string}\n * @constant\n * @private\n */\nexport const ID_OVERLAY_PLEASE_ROTATE = 'pleaseRotate';\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport stereo from './stereo.svg';\n\n/**\n * @summary Navigation bar stereo button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class StereoButton extends AbstractButton {\n\n  static id = 'stereo';\n  static icon = stereo;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-stereo-button', true);\n\n    /**\n     * @type {PSV.plugins.StereoPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = this.psv.getPlugin('stereo');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.STEREO_UPDATED, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.STEREO_UPDATED, this);\n    }\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !this.plugin ? false : { initial: false, promise: this.plugin.prop.isSupported };\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    if (e.type === EVENTS.STEREO_UPDATED) {\n      this.toggleActive(e.args[0]);\n    }\n  }\n\n  /**\n   * @override\n   * @description Toggles stereo control\n   */\n  onClick() {\n    this.plugin.toggle();\n  }\n\n}\n","import {\n\tStereoCamera,\n\tVector2\n} from 'three';\n\n/**\n * Copied from three.js examples\n * @private\n */\nclass StereoEffect {\n\n\tconstructor( renderer ) {\n\n\t\tconst _stereo = new StereoCamera();\n\t\t_stereo.aspect = 0.5;\n\t\tconst size = new Vector2();\n\n\t\tthis.setEyeSeparation = function ( eyeSep ) {\n\n\t\t\t_stereo.eyeSep = eyeSep;\n\n\t\t};\n\n\t\tthis.setSize = function ( width, height ) {\n\n\t\t\trenderer.setSize( width, height );\n\n\t\t};\n\n\t\tthis.render = function ( scene, camera ) {\n\n\t\t\tscene.updateMatrixWorld();\n\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\t\t_stereo.update( camera );\n\n\t\t\trenderer.getSize( size );\n\n\t\t\tif ( renderer.autoClear ) renderer.clear();\n\t\t\trenderer.setScissorTest( true );\n\n\t\t\trenderer.setScissor( 0, 0, size.width / 2, size.height );\n\t\t\trenderer.setViewport( 0, 0, size.width / 2, size.height );\n\t\t\trenderer.render( scene, _stereo.cameraL );\n\n\t\t\trenderer.setScissor( size.width / 2, 0, size.width / 2, size.height );\n\t\t\trenderer.setViewport( size.width / 2, 0, size.width / 2, size.height );\n\t\t\trenderer.render( scene, _stereo.cameraR );\n\n\t\t\trenderer.setScissorTest( false );\n\n\t\t};\n\n\t}\n\n}\n\nexport { StereoEffect };\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport { EVENTS, ID_OVERLAY_PLEASE_ROTATE } from './constants';\nimport mobileRotateIcon from './mobile-rotate.svg';\nimport { StereoButton } from './StereoButton';\nimport { StereoEffect } from './StereoEffect';\n\n\n/**\n * @external NoSleep\n * @description {@link https://github.com/richtr/NoSleep.js}\n */\n\n\n// add stereo button\nDEFAULTS.lang[StereoButton.id] = 'Stereo view';\nregisterButton(StereoButton, 'caption:right');\n\n// other lang strings\nDEFAULTS.lang.stereoNotification = 'Tap anywhere to exit stereo view.';\nDEFAULTS.lang.pleaseRotate = ['Please rotate your device', '(or tap to continue)'];\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Adds stereo view on mobile devices\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class StereoPlugin extends AbstractPlugin {\n\n  static id = 'stereo';\n\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n\n    /**\n     * @type {PSV.plugins.GyroscopePlugin}\n     * @readonly\n     * @private\n     */\n    this.gyroscope = null;\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     * @readonly\n     * @private\n     */\n    this.markers = null;\n\n    /**\n     * @type {PSV.plugins.CompassPlugin}\n     * @readonly\n     * @private\n     */\n    this.compass = null;\n\n    /**\n     * @member {Object}\n     * @protected\n     * @property {Promise<boolean>} isSupported - indicates of the gyroscope API is available\n     * @property {external:THREE.WebGLRenderer} renderer - original renderer\n     * @property {external:NoSleep} noSleep\n     * @property {WakeLockSentinel} wakeLock\n     */\n    this.prop = {\n      isSupported: false,\n      renderer   : null,\n      noSleep    : null,\n      wakeLock   : null,\n    };\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.markers = this.psv.getPlugin('markers');\n    this.compass = this.psv.getPlugin('compass');\n    this.gyroscope = this.psv.getPlugin('gyroscope');\n\n    if (!this.gyroscope) {\n      throw new PSVError('Stereo plugin requires the Gyroscope plugin');\n    }\n\n    this.prop.isSupported = this.gyroscope.prop.isSupported;\n\n    this.psv.on(CONSTANTS.EVENTS.STOP_ALL, this);\n    this.psv.on(CONSTANTS.EVENTS.CLICK, this);\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.STOP_ALL, this);\n    this.psv.off(CONSTANTS.EVENTS.CLICK, this);\n\n    this.stop();\n\n    delete this.markers;\n    delete this.compass;\n    delete this.gyroscope;\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    switch (e.type) {\n      case CONSTANTS.EVENTS.STOP_ALL:\n      case CONSTANTS.EVENTS.CLICK:\n        this.stop();\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * @summary Checks if the stereo view is enabled\n   * @returns {boolean}\n   */\n  isEnabled() {\n    return !!this.prop.renderer;\n  }\n\n  /**\n   * @summary Enables the stereo view\n   * @description\n   *  - enables NoSleep.js\n   *  - enables full screen\n   *  - starts gyroscope controle\n   *  - hides markers, navbar and panel\n   *  - instanciate {@link external:THREE.StereoEffect}\n   * @returns {Promise}\n   * @fires PSV.plugins.StereoPlugin.stereo-updated\n   * @throws {PSV.PSVError} if the gyroscope API is not available/granted\n   */\n  start() {\n    // Need to be in the main event queue\n    this.psv.enterFullscreen();\n    this.__startNoSleep();\n    this.__lockOrientation();\n\n    return this.gyroscope.start().then(() => {\n      // switch renderer\n      this.prop.renderer = this.psv.renderer.renderer;\n      this.psv.renderer.renderer = new StereoEffect(this.psv.renderer.renderer);\n\n      this.psv.needsUpdate();\n\n      this.markers?.hide();\n      this.compass?.hide();\n      this.psv.navbar.hide();\n      this.psv.panel.hide();\n\n      this.trigger(EVENTS.STEREO_UPDATED, true);\n\n      this.psv.notification.show({\n        content: this.psv.config.lang.stereoNotification,\n        timeout: 3000,\n      });\n    }, () => {\n      this.__unlockOrientation();\n      this.__stopNoSleep();\n      this.psv.exitFullscreen();\n    });\n  }\n\n  /**\n   * @summary Disables the stereo view\n   * @fires PSV.plugins.StereoPlugin.stereo-updated\n   */\n  stop() {\n    if (this.isEnabled()) {\n      this.psv.renderer.renderer = this.prop.renderer;\n      this.prop.renderer = null;\n\n      this.psv.needsUpdate();\n\n      this.markers?.show();\n      this.compass?.show();\n      this.psv.navbar.show();\n\n      this.__unlockOrientation();\n      this.__stopNoSleep();\n      this.psv.exitFullscreen();\n      this.gyroscope.stop();\n\n      this.trigger(EVENTS.STEREO_UPDATED, false);\n    }\n  }\n\n  /**\n   * @summary Enables or disables the stereo view\n   */\n  toggle() {\n    if (this.isEnabled()) {\n      this.stop();\n    }\n    else {\n      this.start();\n    }\n  }\n\n  /**\n   * @summary Enables WakeLock or NoSleep.js\n   * @private\n   */\n  __startNoSleep() {\n    if ('wakeLock' in navigator) {\n      navigator.wakeLock.request('screen')\n        .then((wakeLock) => {\n          this.prop.wakeLock = wakeLock;\n        })\n        .catch(() => utils.logWarn('Cannot acquire WakeLock'));\n    }\n    else if ('NoSleep' in window) {\n      if (!this.prop.noSleep) {\n        this.prop.noSleep = new window.NoSleep();\n      }\n      this.prop.noSleep.enable();\n    }\n    else {\n      utils.logWarn('NoSleep is not available');\n    }\n  }\n\n  /**\n   * @summary Disables WakeLock or NoSleep.js\n   * @private\n   */\n  __stopNoSleep() {\n    if (this.prop.wakeLock) {\n      this.prop.wakeLock.release();\n      this.prop.wakeLock = null;\n    }\n    else if (this.prop.noSleep) {\n      this.prop.noSleep.disable();\n    }\n  }\n\n  /**\n   * @summary Tries to lock the device in landscape or display a message\n   * @private\n   */\n  __lockOrientation() {\n    let displayRotateMessageTimeout;\n\n    const displayRotateMessage = () => {\n      if (window.innerHeight > window.innerWidth) {\n        this.psv.overlay.show({\n          id     : ID_OVERLAY_PLEASE_ROTATE,\n          image  : mobileRotateIcon,\n          text   : this.psv.config.lang.pleaseRotate[0],\n          subtext: this.psv.config.lang.pleaseRotate[1],\n        });\n      }\n\n      if (displayRotateMessageTimeout) {\n        clearTimeout(displayRotateMessageTimeout);\n        displayRotateMessageTimeout = null;\n      }\n    };\n\n    if (window.screen?.orientation) {\n      window.screen.orientation.lock('landscape').then(null, () => displayRotateMessage());\n      displayRotateMessageTimeout = setTimeout(() => displayRotateMessage(), 500);\n    }\n    else {\n      displayRotateMessage();\n    }\n  }\n\n  /**\n   * @summary Unlock the device orientation\n   * @private\n   */\n  __unlockOrientation() {\n    if (window.screen?.orientation) {\n      window.screen.orientation.unlock();\n    }\n    else {\n      this.psv.overlay.hide(ID_OVERLAY_PLEASE_ROTATE);\n    }\n  }\n\n}\n"],"names":["EVENTS","STEREO_UPDATED","ID_OVERLAY_PLEASE_ROTATE","StereoButton","navbar","plugin","psv","getPlugin","on","destroy","off","isSupported","initial","promise","prop","handleEvent","e","type","toggleActive","args","onClick","toggle","AbstractButton","id","icon","stereo","StereoEffect","renderer","_stereo","StereoCamera","aspect","size","Vector2","setEyeSeparation","eyeSep","setSize","width","height","render","scene","camera","updateMatrixWorld","parent","update","getSize","autoClear","clear","setScissorTest","setScissor","setViewport","cameraL","cameraR","DEFAULTS","lang","registerButton","stereoNotification","pleaseRotate","StereoPlugin","gyroscope","markers","compass","noSleep","wakeLock","init","PSVError","CONSTANTS","STOP_ALL","CLICK","stop","isEnabled","start","enterFullscreen","__startNoSleep","__lockOrientation","then","needsUpdate","hide","panel","trigger","notification","show","content","config","timeout","__unlockOrientation","__stopNoSleep","exitFullscreen","navigator","request","catch","utils","logWarn","window","NoSleep","enable","release","disable","displayRotateMessageTimeout","displayRotateMessage","innerHeight","innerWidth","overlay","image","mobileRotateIcon","text","subtext","clearTimeout","screen","orientation","lock","setTimeout","unlock","AbstractPlugin"],"mappings":"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"}