// data object of the site's content
const data = {
  pages: {
    "interactive-art": {
      title: "Interactive Art",
      pages: {
        "ancestors-gate": {
          title: "Ancestorsâ€™ Gate",
          subtitle: "A portal for past generations to speak to us",
          year: "2023",
          tags: [
            "crt",
            "projection",
            "microcontroller",
            "vintage tech",
            "indigenous",
          ],
          heroVideo: true,
          content:
            "<p>The story of Indigenous language and cultural near-extinction, and later renaissance, has played out in parallel among Indigenous tribes, nations and peoples in North and South America, Australia and the Pacific, and elsewhere around the world. We can all point to a past generation of our respective peoples, within memory, who spoke our languages maternally.</p><p>Imagine yourself as one of the people of that generation -- perhaps someone in your own family who you knew, or know about, or someone in the Native community where you're from, or even their ancestors beyond that.</p><p>Imagine you're gifted with a time portal they can use to send something through to this generation. A way to communicate directly with us.</p><p>What kind of story, song, message or knowledge would you send?</p>",
        },
        "dancing-light-lanterns": {
          title: "Dancing Light Lanterns",
          subtitle: "A portal for past generations to speak to us",
          year: "2022",
          tags: ["microcontroller", "indigenous"],
          heroVideo: false,
          content:
            "<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Similique dignissimos itaque labore optio nulla qui laboriosam, reprehenderit a deserunt! Eius nesciunt fugit ad neque assumenda doloribus voluptatum vitae praesentium dolorem.</p>",
        },
        "indigital-arcade": {
          title: "<span>inDigital</span> Arcade",
          subtitle: "A portal for past generations to speak to us",
          year: "2021",
          tags: ["retro gaming", "indigenous"],
          heroVideo: false,
          content:
            "<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Similique dignissimos itaque labore optio nulla qui laboriosam, reprehenderit a deserunt! Eius nesciunt fugit ad neque assumenda doloribus voluptatum vitae praesentium dolorem.</p>",
        },
        "trivia-phone": {
          title: "Trivia Phone",
          subtitle: "A portal for past generations to speak to us",
          year: "2021",
          tags: ["projection", "microcontroller", "vintage tech"],
          heroVideo: false,
          content:
            "<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Similique dignissimos itaque labore optio nulla qui laboriosam, reprehenderit a deserunt! Eius nesciunt fugit ad neque assumenda doloribus voluptatum vitae praesentium dolorem.</p>",
        },
      },
    },
    "web-development": {
      title: "Web Development",
      pages: {
        "red-nucleus": {
          title: "Red Nucleus",
          subtitle: "A portal for past generations to speak to us",
          year: "2022",
          tags: ["microcontroller", "indigenous"],
          bezel: "4ktv",
          content:
            "<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Similique dignissimos itaque labore optio nulla qui laboriosam, reprehenderit a deserunt! Eius nesciunt fugit ad neque assumenda doloribus voluptatum vitae praesentium dolorem.</p>",
        },
        "klick-health": {
          title: "Klick Health",
          subtitle: "A portal for past generations to speak to us",
          year: "2021",
          tags: ["retro gaming", "indigenous"],
          bezel: "ipad-pro-2020",
          content:
            "<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Similique dignissimos itaque labore optio nulla qui laboriosam, reprehenderit a deserunt! Eius nesciunt fugit ad neque assumenda doloribus voluptatum vitae praesentium dolorem.</p>",
        },
        stackadapt: {
          title: "StackAdapt",
          subtitle: "A portal for past generations to speak to us",
          year: "2019",
          tags: ["projection", "microcontroller", "vintage tech"],
          bezel: ["macbook-pro-2016", "iphone-11"],
          content:
            "<p>StackAdapt is one of the fastest-growing tech startups in Toronto, with an innovative native advertising platform that enables brands to accelerate customer engagement and acquisition.</p><p>At their rate of growth, they saw a need to build a digital marketing team and elevate their online presence. In 2017, they hired me as a Front End Engineer to give much-needed focus to their homepage and blog.</p><p>I worked closely with the newly-created Design and Marketing teams to revamp the company homepage, introduce new product pages and industry pages tailored to specific verticals, an interactive Ad Format Showcase, and make many other additions and tweaks along the way.</p><p>I overhauled their lead generation form at the bottom of each page, enabling A/B testing with measurable performance comparison, adding new layers of in-browser validation and anti-spam measures, and improving the integration with Slack API and Pardot that powers their pipeline from user signup to lead qualification and live product demo.</p><p>I set up a new WordPress installation, migrated their old blog posts, and developed a custom WordPress theme that integrates seamlessly with their homepage.</p><p>StackAdapt's rapid market growth over my time there was the product of a cross-team effort&mdash;but the projects I executed to expand their online reach, and the technical capacity gained by having a developer like myself on their marketing team, helped to deliver tangible results.</p>",
        },
        diply: {
          title: "Diply",
          subtitle: "A portal for past generations to speak to us",
          year: "2017",
          tags: ["projection", "microcontroller", "vintage tech"],
          bezel: ["macbook-pro-2016", "iphone-7-plus"],
          content:
            "<p>Diply was one of the leading social news/entertainment websites in the world and among the top 20 most visited websites in Canada, publishing articles on internet culture, food, fashion, celebrity news, user-generated content and much more.</p><p>In 2016, they were in the early stages of creating self-publishing tools and user dashboard web applications, and experimenting with new designs for their homepage. In addition, they were growing their staff and opening a new Toronto office. They were growing and scaling, and betting big on a new design-focused direction for their products.</p><p>I was hired as a design technologist to augment their growing Design team. One of my first tasks was to work closely with the designers to develop rapid prototypes, which we used for user and stakeholder testing, internal demos and design review. A few of these prototypes are shown here.</p><p>Using a lightweight Node/SASS/JS tech stack, I produced high-fidelity prototypes to help realize a new look and feel for Diply's homepage, on both mobile and desktop, and helped refine the user flows and experience for their new self-publishing tools. I continued working on these interfaces and tools in the production environment, building and styling components in Angular for the final product.</p><p>Diply's new rapid iteration and prototype-driven design process enabled them to move quickly on experimental UI and evaluation, collecting feedback early in the process, and reducing the need for changes during development. Their newfound agility resulted in a more up-to-date user experience across all of their online offerings.</p>",
        },
        infusion: {
          title: "Infusion",
          subtitle: "A portal for past generations to speak to us",
          year: "2016",
          tags: ["projection", "microcontroller", "vintage tech"],
          bezel: "macbook-pro-2016",
          content:
            "<p>Infusion (now Avanade) is a global engineering, design and digital strategy firm with an emphasis on solutions built with Microsoft technologies. Their clients included retail, education, healthcare, financial services, the energy sector and others. Their projects ranged from customer-facing digital experiences to enterprise-level application software.</p><p>In 2013, their client, Richtree Natural Markets, was developing a brand-new food court concept at the Toronto Eaton Centre. Infusion was tasked with providing digital ordering touch screens, overhead menus and interactive installations for the new food court space.</p><p>With my prior experience in XAML, I was hired to develop UI for the various Windows WPF applications that powered these experiences.</p><p>Later, as Infusion was incubating a digital marketing agency within the firm, I continued as a member of their Interactive Development team, a multidisciplinary group of design-aware, marketing-savvy creative technologists, developers and designers.</p><p>In my time there, I helped produce innovative and exciting digital experiences for various clients, pitch work, rapid prototypes, UX design, front end and UI development on various platforms including: Web, Windows, Android, Samsung Gear wearables, Unity, Microsoft Hololens and more.</p><p>Working at Infusion was a wonderful experience for me, as I got to learn and play with many new technologies and to build experiences on various platforms, particularly VR/AR.</p>",
        },
        nventive: {
          title: "nventive",
          subtitle: "A portal for past generations to speak to us",
          year: "2013",
          tags: ["projection", "microcontroller", "vintage tech"],
          bezel: ["win-tablet", "win-phone"],
          content:
            "<p>nventive is an agile mobile and web application studio, which in 2012-2013 was designing and building apps on Windows Phone and Windows 8 devices.</p><p>At the time I started there, Microsoft was investing heavily in the Windows Phone app ecosystem, and nventive was one of the studios that produced full-featured Windows Phone and Windows 8 apps for clients such as ABC News, AllRecipes, Bloomberg, Expedia and others.</p><p>Their need for a Windows XAML front end developer was so urgent, and the hiring pool so small, that they hired me based on my skill level with HTML/CSS and started training me on XAML development on the first day.</p><p>After two weeks, I was competent enough to work on production codebases, and with the rest of my time there, I learned much more.</p><p>I introduced a practice of producing app-level style guides early in the design process, which outlined colour resources, font sizes and styles, etc. helping the Design and Development teams work together more effectively.</p>",
        },
      },
    },
    "game-development": {
      title: "Game Development",
      content:
        "<p>OnÃ©nhsto, or &quot;Corn Soup&quot;, is a fun game that teaches Kanien'kÃ©ha language, culture and traditions by replicating elder, family and community teaching experiences.</p><p>In this game, you are cast into the role of a young Mohawk boy, spending time with his To'ta (Grandmother). Around her house, and in the garden, are all the ingredients necessary to make her famous corn soup. Forage and collect all of the ingredients, and don't forget to find the recipe book too!</p><p>As you explore the level, you will come across corn and beans in the garden, wild strawberries in the woods, and much more. As you approach these items, the word for the item appears in Kanien'kÃ©ha.</p><p>By collecting all of the ingredients and the recipe book, you can learn how to make Mohawk corn soup, based on traditional recipes handed down over generations. Additional items found in the level, like strawberries, can unlock additional surprises!</p><p>The vision for this game was conceived during ImagineNATIVE's Land Jam game hackathon in June 2022. Myself and a team of others all happened to have roots in different Mohawk communities, which led us to think about ways to propagate and teach our language, culture and traditions to other Mohawks displaced from communities, especially children. The idea to create an educational children's adventure game was born.</p><p>I undertook a lot of learning to leverage my web development skill set for the new task of building a 3D game. This involved code review, tutorial consumption, experimentation and prototyping. What I couldn't fully develop on my own, I broke down into manageable tasks and enlisted help from some Unity developer friends and colleagues. In turn, I gleaned additional learning from reviewing the approaches they took and the code they wrote. I reached out to my partner Jenn to create some art for the characters and items in the game.</p><p>For more information or to download a demo of OnÃ©nhsto, visit the <a target='_blank' href='https://onenhsto.com/''>official website</a>.</p>",
    },
    "workshops-and-education": {
      title: "Workshops + Education",
      content:
        "<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Similique dignissimos itaque labore optio nulla qui laboriosam, reprehenderit a deserunt! Eius nesciunt fugit ad neque assumenda doloribus voluptatum vitae praesentium dolorem.</p>",
    },
  },
};

// TODO: move data functions up here, use lv1Array and lv2Array to create pages and nav, as well as for findMatchingPage
// TODO: simplify how userClicked is used, create one event listener for all a tags

// DOM elements
const pages = data.pages;
const body = document.querySelector("body");
const header = document.querySelector("header");
const nav = document.querySelector("nav");
const main = document.querySelector("main");

// state variables
let userClicked = false;
let lv1Page = "";
let lv2Page = "";
let thisPage = "";
let lastPage = "";

function convertToTitleCase(str) {
  // Step 1: Convert all hyphens to spaces
  const stringWithSpaces = str.replace(/-/g, " ");

  // Step 2: Convert to title case
  const titleCaseString = stringWithSpaces.replace(/\b\w/g, (match) =>
    match.toUpperCase()
  );

  return titleCaseString;
}

// creates index pages
function createIndexPages(pages, container, parent) {
  for (const pageId in pages) {
    if (pages.hasOwnProperty(pageId)) {
      const page = pages[pageId];
      const a = document.createElement("a");
      const img = document.createElement("img");
      const year = document.createElement("div");
      const label = document.createElement("h2");

      a.className = "hero";
      year.className = "year";
      label.className = "label";

      img.setAttribute("src", "assets/" + parent + "/" + pageId + ".jpg");
      img.setAttribute("loading", "lazy");
      year.innerText = page.year;
      label.innerHTML = page.title;

      a.setAttribute("href", "#" + pageId);

      a.appendChild(img);
      a.appendChild(year);
      a.appendChild(label);
      a.addEventListener("click", (e) => {
        userClicked = true;
      });

      container.appendChild(a);
    }
  }
}

function createPages(pages, parent) {
  for (const pageId in pages) {
    if (pages.hasOwnProperty(pageId)) {
      const page = pages[pageId];
      const div = document.createElement("div");

      div.id = pageId;

      if (page.pages) {
        div.className = "page page-lv1 " + pageId;
        createPages(page.pages, pageId);
        createIndexPages(page.pages, div, pageId);
      } else {
        div.className = "page page-lv2 " + parent;

        if (parent === "web-development") {
          if (Array.isArray(page.bezel)) {
            hero = `
                <div class="hero hero-interactive-art">
                    <div class="bezel bezel-${page.bezel[0]}">
                        <img 
                          loading="lazy"
                          class="img" 
                          src="assets/bezel-${page.bezel[0]}-mobile.png" 
                          widths="90vw"
                          srcset="assets/bezel-${page.bezel[0]}-mobile.png 768w,
                                  assets/bezel-${page.bezel[0]}-desktop.png 1024w"/>
                        <video preload="none" class="screen-content screen-content-video" muted loop playsinline src="assets/web-development/${pageId}-${page.bezel[0]}.mp4" poster="assets/web-development/${pageId}-${page.bezel[0]}.jpg" type="video/mp4"></video>
                        <div class="overlay">
                            <svg class="svg svg-icon svg-play-icon" viewBox="0 0 40 35">
                                <use xlink:href="#play-btn" />
                            </svg>
                            <svg class="svg svg-icon svg-pause-icon" viewBox="0 0 40 35">
                                <use xlink:href="#pause-btn" />
                            </svg>
                            <svg class="svg svg-icon svg-loading" viewBox="0 0 80 80">
                                <use xlink:href="#spinner" />
                            </svg>
                        </div>
                    </div>
                    <div class="bezel bezel-${page.bezel[1]}">
                        <img 
                          loading="lazy"
                          class="img" 
                          src="assets/bezel-${page.bezel[1]}-mobile.png" 
                          widths="90vw"
                          srcset="assets/bezel-${page.bezel[1]}-mobile.png 768w,
                                  assets/bezel-${page.bezel[1]}-desktop.png 1024w"/>
                        <video preload="none" class="screen-content screen-content-video" muted loop playsinline src="assets/web-development/${pageId}-${page.bezel[1]}.mp4" poster="assets/web-development/${pageId}-${page.bezel[1]}.jpg" type="video/mp4"></video>
                        <div class="overlay">
                            <svg class="svg svg-icon svg-play-icon" viewBox="0 0 40 35">
                                <use xlink:href="#play-btn" />
                            </svg>
                            <svg class="svg svg-icon svg-pause-icon" viewBox="0 0 40 35">
                                <use xlink:href="#pause-btn" />
                            </svg>
                            <svg class="svg svg-icon svg-loading" viewBox="0 0 80 80">
                                <use xlink:href="#spinner" />
                            </svg>
                        </div>
                    </div>
                </div>
            `;
          } else {
            hero = `
                <div class="hero hero-interactive-art">
                    <div class="bezel bezel-1 bezel-${page.bezel}">
                        <img 
                          loading="lazy"
                          class="img" 
                          src="assets/bezel-${page.bezel}-mobile.png" 
                          widths="90vw"
                          srcset="assets/bezel-${page.bezel}-mobile.png 768w,
                                  assets/bezel-${page.bezel}-desktop.png 1024w"/>
                        <video preload="none" class="screen-content screen-content-video" muted loop playsinline src="assets/web-development/${pageId}-${page.bezel}.mp4" poster="assets/web-development/${pageId}-${page.bezel}.jpg" type="video/mp4"></video>
                        <div class="overlay">
                            <svg class="svg svg-icon svg-play-icon" viewBox="0 0 40 35">
                                <use xlink:href="#play-btn" />
                            </svg>
                            <svg class="svg svg-icon svg-pause-icon" viewBox="0 0 40 35">
                                <use xlink:href="#pause-btn" />
                            </svg>
                            <svg class="svg svg-icon svg-loading" viewBox="0 0 80 80">
                                <use xlink:href="#spinner" />
                            </svg>
                        </div>
                    </div>
                </div>
            `;
          }
          article = `
            <div class="article">
              <h1>${page.title}</h1>
              <div class="year">${page.year}</div>
              <div class="tags">
                <span class="tag">crt</span>
                <span class="tag">projector</span>
                <span class="tag">microcontroller</span>
                <span class="tag">vintage tech</span>
                <span class="tag">indigenous</span>
              </div>
              <div class="content">
                ${page.content}
              </div>
            </div>
          `;
        } else if (parent === "interactive-art") {
          if (page.heroVideo) {
            hero = `
            <div class="hero">
              <video preload="none" class="img mobile" src="assets/${parent}/${pageId}-mobile.mp4" poster="assets/${parent}/${pageId}-mobile.jpg" muted loop playsinline></video>
              <video preload="none" class="img desktop" src="assets/${parent}/${pageId}-desktop.mp4" poster="assets/${parent}/${pageId}-desktop.jpg" muted loop playsinline></video>
            </div>
            `;
          } else {
            hero = `
            <div class="hero">
              <img loading="lazy" class="img mobile desktop" src="assets/${parent}/${pageId}.jpg" />
            </div>
            `;
          }
          article = `
            <div class="article">
              <h1>${page.title}</h1>
              <h2>${page.subtitle}</h2>
              <div class="year">${page.year}</div>
              <div class="tags">
                <span class="tag">crt</span>
                <span class="tag">projector</span>
                <span class="tag">microcontroller</span>
                <span class="tag">vintage tech</span>
                <span class="tag">indigenous</span>
              </div>
              <div class="content">
                ${page.content}
              </div>
            </div>
          `;
        } else {
          hero = `
          <div class="hero">
            <img class="img mobile desktop" src="assets/${parent}/${pageId}.jpg" />
          </div>
          `;
          article = `
            <div class="article">
              <h1>${page.title}</h1>
              <div class="year">${page.year}</div>
              <div class="tags">
                <span class="tag">crt</span>
                <span class="tag">projector</span>
                <span class="tag">microcontroller</span>
                <span class="tag">vintage tech</span>
                <span class="tag">indigenous</span>
              </div>
              <div class="content">
                ${page.content}
              </div>
            </div>
          `;
        }

        div.insertAdjacentHTML("afterbegin", hero);
        div.insertAdjacentHTML("beforeend", article);
      }

      main.appendChild(div);
    }
  }
}

function createNav() {
  for (const pageId in pages) {
    if (pages.hasOwnProperty(pageId)) {
      const page = pages[pageId];
      const div = document.createElement("div");
      const container = document.createElement("div");
      const label = document.createElement("a");
      const backBtn = document.createElement("a");

      label.setAttribute("href", "#" + pageId);
      label.addEventListener("click", (e) => {
        userClicked = true;
      });
      backBtn.setAttribute("href", "#");
      backBtn.addEventListener("click", (e) => {
        userClicked = true;
      });

      container.classList.add("container");
      label.classList.add("label");
      backBtn.classList.add("back-btn");

      label.innerText = page.title;

      div.classList.add("nav-item");
      div.classList.add(pageId);
      nav.appendChild(div);
      div.appendChild(container);
      container.appendChild(backBtn);
      container.appendChild(label);
    }
  }
}

function urlCheck() {
  const hash = window.location.hash.slice(1);

  if (hash) {
    body.className = "ext-ref";

    findMatchingPage(data.pages, hash);

    if (lastPage) {
      const lastPageElement = document.querySelector("#" + lv1Page);
      const thisPageElement = document.querySelector("#" + thisPage);
      const backBtn = document.querySelector(
        ".nav-item." + lv1Page + " .back-btn"
      );
      backBtn.setAttribute("href", "#" + lastPage);
      lastPageElement.classList.add("visited");
      if (lastPage === "interactive-art") {
        thisPageElement.addEventListener("scroll", handlePageScroll);
        window.addEventListener("scroll", handleWindowScroll);
      }
    }

    const nextURL = "/" + hash;
    const nextTitle = convertToTitleCase(hash) + " - Steve Diabo";
    const nextState = {};

    document.title = nextTitle;
    window.history.replaceState(nextState, nextTitle, nextURL);

    header.classList.add("navigated");
    nav.classList.add("show-" + lv1Page);
    main.classList.add("show-lv2");
    document.querySelector("#" + hash).classList.add("active");
  }
}

function findMatchingPage(pages, hash) {
  if (pages.hasOwnProperty(hash)) {
    lv1Page = hash;
    lv2Page = "";
    thisPage = lv1Page;
    lastPage = "";
    return;
  }

  for (const key in pages) {
    const page = pages[key];
    if (typeof page === "object" && page.pages) {
      if (page.pages.hasOwnProperty(hash)) {
        lv1Page = key;
        lv2Page = hash;
        thisPage = lv2Page;
        lastPage = lv1Page;
        return;
      }

      findMatchingPage(page.pages, hash, key);
    }
  }
  if (!hash) {
    // home page
    lv1Page = "";
    lv2Page = "";
    thisPage = "";
    lastPage = "";
    return;
  }
  // 404 condition
  console.log("404: " + hash);
  return;
}

function showPage(pageId) {
  if (thisPage) {
    const thisPageElement = document.querySelector("#" + thisPage);
    thisPageElement.classList.remove("active");
    thisPageElement.classList.add("visited");
    thisPageElement.removeEventListener("scroll", handlePageScroll);
    window.removeEventListener("scroll", handleWindowScroll);
  }

  findMatchingPage(pages, pageId);

  const thisPageElement = document.querySelector("#" + thisPage);
  const backBtn = document.querySelector(".nav-item." + lv1Page + " .back-btn");
  backBtn.addEventListener("click", () => {
    userClicked = true;
  });
  body.classList = "";
  header.classList.add("navigated");
  nav.className = "";
  nav.classList.add("show-" + lv1Page);
  if (lastPage) {
    main.classList.remove("show-lv1");
    main.classList.add("show-lv2");
    backBtn.setAttribute("href", "#" + lastPage);
    if (lastPage === "interactive-art") {
      thisPageElement.addEventListener("scroll", handlePageScroll);
      window.addEventListener("scroll", handleWindowScroll);
    }
  } else {
    main.classList.remove("show-lv2");
    main.classList.add("show-lv1");
    backBtn.setAttribute("href", "#");
  }
  thisPageElement.classList.add("active");
}

function setupVideo(video) {
  video.removeEventListener("click", function () {
    setupVideo(video);
  });
  video.play();
  video.addEventListener("click", function () {
    if (video.paused) {
      console.log("play");
      video.play();
    } else {
      console.log("pause");
      video.pause();
    }
  });
  video.addEventListener("loadstart", function () {
    video.nextElementSibling.classList.add("loading");
    video.classList.add("loading");
  });
  video.addEventListener("play", function () {
    video.nextElementSibling.classList.remove("paused", "loading");
    video.nextElementSibling.classList.add("playing");
    video.classList.remove("paused", "loading");
    video.classList.add("playing");
  });

  video.addEventListener("pause", function () {
    video.nextElementSibling.classList.remove("playing");
    video.nextElementSibling.classList.add("paused");
    video.classList.remove("playing");
    video.classList.add("paused");
  });
}

function videoHandler() {
  const videos = document.querySelectorAll(".screen-content-video");

  function clickHandler(event) {
    const video = event.target;
    console.log("first click");
    setupVideo(video);
    video.removeEventListener("click", clickHandler); // Remove the event listener after the first click
  }

  videos.forEach(function (video) {
    video.addEventListener("click", clickHandler);
  });
}

function handleWindowScroll() {
  const distance = window.scrollY;
  if (distance < 0) distance = 0;
  if (thisPage) {
    document.querySelector(
      "#" + thisPage + ".page-lv2 .hero .img.desktop"
    ).style.transform = `translateY(${distance * 0.5}px)`;
  }
}

function handlePageScroll() {
  const thisPageElement = document.querySelector("#" + thisPage);
  const distance = thisPageElement.scrollTop;
  if (distance < 0) distance = 0;
  if (thisPage) {
    document.querySelector(
      "#" + thisPage + ".page-lv2 .hero .img.mobile"
    ).style.transform = `translateY(${distance * 0.5}px)`;
  }
}

function backToHome() {
  if (thisPage) {
    const thisPageElement = document.querySelector("#" + thisPage);
    thisPageElement.classList.remove("active");
    nav.className = "";
    nav.classList.add("from-" + lv1Page);
  }

  findMatchingPage(pages, pageId);

  header.classList.remove("navigated");
  main.className = "";

  const visitedPages = document.querySelectorAll(".visited");
  visitedPages.forEach((page) => {
    page.classList.remove("visited");
  });
}

function handleHashChange() {
  pageId = window.location.hash.slice(1);

  const nextURL = "/" + pageId;
  const nextTitle = convertToTitleCase(pageId) + " - Steve Diabo";
  const nextState = {};

  document.title = nextTitle;
  window.history.replaceState(nextState, nextTitle, nextURL);

  if (pageId) {
    showPage(pageId);
  } else {
    backToHome();
  }
}

function handlePopState(event) {
  pageId = window.location.pathname.slice(1);
  if (!userClicked) {
    if (pageId) {
      showPage(pageId);
    } else {
      backToHome();
    }
  }
  userClicked = false;
}

document.addEventListener("DOMContentLoaded", () => {
  createPages(data.pages);
  createNav();
  urlCheck();
  videoHandler();
});

window.addEventListener("hashchange", () => {
  handleHashChange();
});
window.addEventListener("popstate", () => {
  handlePopState();
});
